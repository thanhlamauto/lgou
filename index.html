
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Gôu - Tranh Lego Quà Tặng Cá Nhân Hóa Cho Mọi Dịp</title>
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lgou.com/">
    <meta property="og:title" content="L'Gôu - Tranh Lego Quà Tặng Cá Nhân Hóa Cho Mọi Dịp">
    <meta property="og:description" content="Món quà ý nghĩa cho Anniversary, Tốt nghiệp, Sinh nhật... thể hiện cá tính riêng của bạn!"
    <meta property="og:image" content="https://i.postimg.cc/7YKWGsqK/logo-L-Go-u-tra-ng-page-0001.jpg">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="L'Gôu - Tranh Lego Quà Tặng Cá Nhân Hóa Cho Mọi Dịp">
    <meta name="twitter:description" content="Món quà ý nghĩa cho Anniversary, Tốt nghiệp, Sinh nhật... thể hiện cá tính riêng của bạn!">
    <meta name="twitter:image" content="https://i.postimg.cc/7YKWGsqK/logo-L-Go-u-tra-ng-page-0001.jpg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #4a90a4;
            --primary-blue-dark: #2c5f73;
            --primary-blue-light: #6bb6cc;
            --accent-yellow: #f4e4a6;
            --accent-yellow-light: #f9f0c4;
            --white: #ffffff;
            --off-white: #f8f9fa;
            --text-dark: #2c5f73;
            --text-light: #6c757d;
            --background-gradient: linear-gradient(135deg, #f9f0c4 0%, #f4e4a6 20%, #e8d5a3 40%, #d4c5a0 60%, #a4b8c4 80%, #4a90a4 100%);
            --card-background: rgba(244, 228, 166, 0.3);
            --card-background-hover: rgba(244, 228, 166, 0.5);
            --button-gradient: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
            --light-gray-bg: #f8f9fa;
            --light-gray-border: #dee2e6;
            --free-ship-threshold: 349000;
            --zalo-blue: #0068ff;
            --facebook-blue: #4267B2;
            --instagram-purple: #833AB4;
            --error-red: #dc3545;
            --success-green: #28a745;
            --step-active: var(--primary-blue);
            --step-inactive: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: var(--background-gradient);
            background-attachment: fixed;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            min-height: 100vh;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background-gradient);
            background-attachment: fixed;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            color: var(--text-dark);
            line-height: 1.6;
            padding-bottom: 70px;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 15px;
        }

        .header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 15px;
        }

        .logo-image {
            height: 80px;
            transition: transform 0.3s ease;
        }
        
        .logo-image:hover {
            transform: scale(1.05);
        }

        /* Hero Section */
        .hero-section {
            position: relative;
            padding: 80px 15px;
            text-align: center;
            overflow: hidden;
            background: transparent;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-blue);
            font-family: 'Montserrat', sans-serif;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .hero-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--text-dark);
            font-weight: 400;
            line-height: 1.6;
        }

        .btn-primary-custom {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: var(--button-gradient);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 8px 25px rgba(74, 144, 164, 0.3);
        }

        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(74, 144, 164, 0.4);
            color: white;
            background: linear-gradient(135deg, var(--primary-blue-light), var(--primary-blue));
        }

        .hero-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .hero-icon {
            font-size: 2rem;
            color: var(--primary-blue);
            animation: float 3s ease-in-out infinite;
        }

        .hero-icon:nth-child(2) { animation-delay: 0.5s; }
        .hero-icon:nth-child(3) { animation-delay: 1s; }
        .hero-icon:nth-child(4) { animation-delay: 1.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Sparkle Animation */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary-blue);
            border-radius: 50%;
            animation: sparkle 2s linear infinite;
        }

        .sparkle:nth-child(1) {
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .sparkle:nth-child(2) {
            top: 30%;
            right: 20%;
            animation-delay: 0.5s;
        }

        .sparkle:nth-child(3) {
            bottom: 30%;
            left: 30%;
            animation-delay: 1s;
        }

        .sparkle:nth-child(4) {
            bottom: 20%;
            right: 30%;
            animation-delay: 1.5s;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* Featured Section */
        .featured-section {
            padding: 60px 15px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }

        .featured-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 40px;
            font-family: 'Montserrat', sans-serif;
        }

        .featured-title i {
            color: var(--primary-blue);
            margin-right: 10px;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .product-card {
            background: var(--card-background);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--button-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .product-card:hover::before {
            transform: scaleX(1);
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(74, 144, 164, 0.2);
            background: var(--card-background-hover);
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: var(--button-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
        }

        .product-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .product-desc {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .product-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-blue-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Features Section */
        .features-section {
            padding: 60px 15px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-item {
            text-align: center;
            padding: 20px;
        }

        .feature-icon {
            width: 70px;
            height: 70px;
            background: var(--button-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        .feature-item:nth-child(2) .feature-icon { animation-delay: 0.5s; }
        .feature-item:nth-child(3) .feature-icon { animation-delay: 1s; }
        .feature-item:nth-child(4) .feature-icon { animation-delay: 1.5s; }

        .feature-item h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .feature-item h4 i {
            color: var(--primary-blue);
        }

        .feature-item p {
            color: var(--text-dark);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 15px;
            text-align: center;
        }

        .tagline {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            max-width: 100%;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-family: 'Montserrat', sans-serif;
        }

        .sub-tagline {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--accent-light);
            font-weight: 500;
            max-width: 800px;
            line-height: 1.7;
        }

        .benefits-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
            width: 100%;
        }

        .benefit-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            max-width: 120px;
            padding: 10px;
        }

        .benefit-icon {
            width: 45px;
            height: 45px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 1.3rem;
            color: white;
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }

        .benefit-text {
            font-size: 0.75rem;
            color: var(--light-pastel-pink);
            line-height: 1.4;
        }

        .section {
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 20px 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary-blue-dark);
            position: relative;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 0 1px 3px rgba(255,255,255,0.8);
            font-weight: 700;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--gradient-pink);
        }

        /* Bước điều hướng */
        .steps-container {
            display: flex;
            justify-content: space-between;
            margin: 30px auto;
            max-width: 800px;
            position: relative;
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .steps-container::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 10%;
            width: 80%;
            height: 3px;
            background: var(--light-gray);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 20%;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--step-inactive);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .step.active .step-icon {
            background: var(--step-active);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(233, 30, 99, 0.5);
        }

        .step-title {
            font-size: 0.85rem;
            text-align: center;
            color: var(--primary-blue-dark);
            font-weight: 500;
            transition: color 0.3s ease;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        .step.active .step-title {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .step-content {
            margin-top: 30px;
        }

        .step-pane {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
        }

        .step-btn {
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
        }

        .prev-btn {
            background: transparent;
            color: var(--light-pastel-pink);
            border: 2px solid var(--light-pastel-pink);
        }

        .prev-btn:hover {
            background: rgba(255, 204, 203, 0.1);
        }

        .next-btn {
            background: var(--gradient-pink);
            color: white;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.3);
        }

        .next-btn:hover {
            background: var(--gradient-light);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.5);
        }

        .step-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Collection Selector Styles */
        .collection-selector {
            width: 100%;
            margin-bottom: 25px;
        }
        
        .collection-title {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 10px;
            color: var(--primary-blue-dark);
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(255,255,255,0.8);
        }
        
        .collection-subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-dark);
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .collection-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .collection-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .collection-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(74, 144, 164, 0.2);
            border-color: var(--primary-blue-light);
        }
        
        .collection-card.active {
            border-color: var(--primary-blue);
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px rgba(74, 144, 164, 0.3);
            transform: translateY(-3px);
        }
        
        .collection-card.limited {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(255, 193, 7, 0.1));
            border-color: #e91e63;
        }
        
        .collection-card.expired {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(128, 128, 128, 0.2);
        }
        
        .collection-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .collection-header h4 {
            font-size: 1.3rem;
            color: var(--primary-blue-dark);
            font-weight: 700;
            margin: 0;
        }
        
        .collection-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .collection-status.available {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .collection-status.limited {
            background: rgba(233, 30, 99, 0.2);
            color: #e91e63;
        }
        
        .collection-status.expired {
            background: rgba(128, 128, 128, 0.2);
            color: #666;
        }
        
        .collection-description {
            margin-bottom: 15px;
            color: var(--text-dark);
            line-height: 1.5;
        }
        
        .collection-timer {
            background: rgba(233, 30, 99, 0.1);
            border: 1px solid rgba(233, 30, 99, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .timer-label {
            font-size: 0.8rem;
            color: #e91e63;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .timer-display {
            font-size: 1.1rem;
            color: #e91e63;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        
        .collection-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .feature-tag {
            background: rgba(74, 144, 164, 0.2);
            color: var(--primary-blue-dark);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .regular-collection {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed rgba(255, 255, 255, 0.3);
        }

        /* Các phần nội dung của bước */
        .version-selector {
            width: 100%;
            margin-bottom: 25px;
        }
        
        .version-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .version-option {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .version-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(44, 62, 80, 0.15);
        }
        
        .version-option.active {
            border-color: var(--primary-blue);
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 25px rgba(74, 144, 164, 0.3);
            transform: translateY(-3px);
        }
        
        .version-option.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .version-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .version-header h3 {
            font-size: 1.4rem;
            margin-bottom: 8px;
            color: var(--primary-blue-dark);
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        
        .version-price {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        
        .version-features {
            text-align: left;
        }
        
        .version-subtitle {
            font-size: 1rem;
            color: var(--primary-blue-dark);
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        
        .version-features ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .version-features li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
            color: var(--text-dark);
            font-weight: 500;
        }
        
        .version-features li::before {
            content: '✓';
            color: var(--primary-blue);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .version-features strong {
            color: var(--primary-blue-dark);
            font-weight: 700;
        }

        /* Step 2: Chọn Background */
        .background-customization {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .preview-container {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--pink);
            min-height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .preview-container:hover {
            transform: scale(1.01);
            box-shadow: 0 0 20px rgba(233, 30, 99, 0.5);
        }
        
        .preview-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .background-note {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .background-note label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-blue-dark);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        .background-note textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-dark);
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .background-note textarea:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 164, 0.2);
        }

        .background-options {
            width: 100%;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
            transition: max-height 0.3s ease, padding 0.3s ease;
            overflow: hidden;
        }

        .option-item {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 15px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            position: relative;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .option-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(233, 30, 99, 0.3);
            border-color: var(--light-pink);
        }
        
        .option-item.out-of-stock {
            opacity: 0.6;
            pointer-events: none;
            filter: grayscale(100%);
        }
        
        .option-item.out-of-stock::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 12px;
        }
        
        .option-stock {
            text-align: center;
            margin-top: 5px;
            font-size: 0.8rem;
        }

        .option-item.selected {
            border-color: var(--pink);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.4);
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: translateY(-5px) scale(1); }
            50% { transform: translateY(-5px) scale(1.05); }
            100% { transform: translateY(-5px) scale(1); }
        }

        .option-thumbnail {
            width: 60px;
            height: 60px;
            background-color: var(--gray);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            overflow: hidden;
            font-size: 0.8rem;
            text-align: center;
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
        }

        .option-item:hover .option-thumbnail {
            transform: scale(1.1);
        }

        .option-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .option-thumbnail.color {
            border: 1px solid var(--light-gray);
        }

        .option-name {
            font-size: 0.8rem;
            text-align: center;
            margin-bottom: 3px;
        }

        .option-price {
            font-size: 0.75rem;
            color: var(--light-pastel-pink);
            font-weight: 600;
        }

        .character-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .character-column {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--light-gray);
        }

        .character-title {
            font-size: 1rem;
            margin-bottom: 12px;
            text-align: center;
            color: var(--light-pastel-pink);
            font-weight: 600;
        }

        .color-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            margin: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            display: inline-block;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.15);
            box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .color-option.selected {
            border-color: var(--white);
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--pink);
        }

        .color-options-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .option-group-title {
            font-size: 0.95rem;
            margin: 10px 0 8px;
            color: var(--light-pastel-pink);
            font-weight: 500;
            text-align: center;
        }

        .color-code {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--pink);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .order-summary {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid var(--light-gray);
        }

        .summary-title {
            font-size: 1.4rem;
            margin-bottom: 18px;
            color: var(--pastel-pink);
            text-align: center;
        }

        .summary-items {
            margin-bottom: 18px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--light-gray);
            font-size: 0.95rem;
        }

        .summary-item.subtotal {
            font-weight: 600;
            color: var(--light-pastel-pink);
        }

        .summary-item.discount {
            color: #4CAF50;
        }

        .summary-item.shipping {
            color: #2196F3;
        }

        .summary-item.total {
            font-size: 1.1rem;
            font-weight: 700;
            border-bottom: none;
            margin-top: 10px;
            color: var(--pastel-pink);
        }

        .discount-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .discount-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--light-pastel-pink);
            cursor: pointer;
        }
        
        .discount-toggle i {
            transition: transform 0.3s ease;
        }
        
        .discount-toggle.active i {
            transform: rotate(180deg);
        }
        
        .discount-form {
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        
        .discount-form.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .discount-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 30px;
            border: 2px solid #e0e0e0;
            background-color: #ffffff;
            color: #333333;
            font-family: inherit;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .discount-input:focus {
            border-color: var(--pink);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 192, 203, 0.3);
        }

        .apply-button {
            padding: 12px 20px;
            background: var(--gradient-pink);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            font-size: 0.95rem;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.3);
        }

        .apply-button:hover {
            background: var(--gradient-light);
            transform: translateY(-2px);
        }

        .discount-result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.95rem;
            display: none;
            transition: all 0.3s ease;
        }

        .discount-result.valid {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            display: block;
        }

        .discount-result.invalid {
            background-color: rgba(244, 67, 54, 0.2);
            color: #F44336;
            display: block;
        }

        .checkout-form {
            background-color: var(--gray);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid var(--light-gray);
        }

        .form-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--pastel-pink);
        }

        .customer-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: var(--light-pastel-pink);
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            background-color: #ffffff;
            color: #333333;
            font-family: inherit;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--pink);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 192, 203, 0.3);
        }

        .form-group input::placeholder, .form-group textarea::placeholder {
            color: #999999;
            opacity: 1;
        }

        /* Date Picker Styles */
        .date-picker-container {
            position: relative;
        }

        .date-picker-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            background-color: #ffffff;
            color: #333333;
            font-family: inherit;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .date-picker-input:focus {
            border-color: var(--pink);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 192, 203, 0.3);
        }

        .date-picker-calendar {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            padding: 15px;
            margin-top: 5px;
        }

        .date-picker-calendar.show {
            display: block;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .calendar-nav:hover {
            background-color: #f0f0f0;
        }

        .calendar-month-year {
            font-weight: 600;
            font-size: 16px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: #666;
            padding: 8px 0;
        }

        .calendar-day {
            text-align: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .calendar-day:hover {
            background-color: #f0f0f0;
        }

        .calendar-day.disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .calendar-day.disabled:hover {
            background-color: transparent;
        }

        .calendar-day.selected {
            background-color: var(--pink);
            color: white;
        }

        .calendar-day.today {
            background-color: #e0e0e0;
            font-weight: 600;
        }

        .date-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .form-error {
            color: var(--error-red);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }
        
        .required-star {
            color: var(--pink);
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        .checkbox-group input {
            margin-right: 10px;
            margin-top: 5px;
        }

        .policy-link {
            color: var(--pastel-pink);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .policy-link:hover {
            text-decoration: underline;
            color: var(--pink);
        }

        .cta-button {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 16px;
            background: var(--gradient-pink);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
            margin-top: 20px;
        }

        .cta-button:hover {
            background: var(--gradient-light);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.5);
        }

        .cta-button:disabled {
            background: var(--light-gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .footer {
            background-color: var(--black);
            padding: 40px 0 20px;
        }

        .policy-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .policy-box {
            background-color: var(--gray);
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .policy-box:hover {
            transform: translateY(-5px);
        }

        .policy-box h3 {
            color: var(--pastel-pink);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .policy-box h3 i {
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .policy-box:hover h3 i {
            transform: rotate(15deg);
        }

        .policy-list {
            list-style-type: none;
        }

        .policy-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .policy-list li::before {
            content: '•';
            color: var(--pastel-pink);
            position: absolute;
            left: 0;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
            color: var(--light-gray);
            font-size: 0.85rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            border: 2px solid var(--pink);
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .close-modal:hover {
            color: var(--pink);
            transform: scale(1.2);
        }

        .save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--gradient-pink);
            color: white;
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 0.9rem;
            z-index: 2000;
            display: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .hat-section {
            padding: 10px 0;
        }
        
        .spinner {
            display: none;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Confirmation Popup */
        .confirmation-popup {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            background-color: var(--dark-gray);
            border-radius: 15px;
            padding: 20px;
            z-index: 3000;
            animation: slideUp 0.5s ease;
            border: 2px solid var(--pink);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            overflow-y: auto;
        }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .confirmation-content {
            text-align: center;
            position: relative;
        }

        .confirmation-icon {
            font-size: 2.5rem;
            color: var(--pink);
            margin-bottom: 15px;
        }

        .confirmation-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--pastel-pink);
            font-family: 'Montserrat', sans-serif;
        }

        .confirmation-subtitle {
            font-size: 1rem;
            margin-bottom: 20px;
            color: var(--light-pastel-pink);
        }
        
        .customer-info {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
        }
        
        .customer-info p {
            margin: 8px 0;
            font-size: 0.95rem;
        }
        
        .customer-info .info-label {
            color: var(--pastel-pink);
            font-weight: 600;
            display: inline-block;
            width: 100px;
        }
        
        .confirmation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .confirmation-button {
            padding: 8px 12px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .confirmation-button.primary {
            background: var(--gradient-pink);
            color: white;
            border: none;
        }
        
        .confirmation-button.zalo {
            background: var(--zalo-blue);
            color: white;
            border: none;
        }
        
        .confirmation-button.facebook {
            background: var(--facebook-blue);
            color: white;
            border: none;
        }
        
        .confirmation-button.instagram {
            background: var(--instagram-purple);
            color: white;
            border: none;
        }
        
        .confirmation-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }
        
        .contact-info {
            margin-top: 15px;
            padding: 12px;
            background-color: rgba(255,255,255,0.05);
            border-radius: 10px;
            font-size: 0.85rem;
        }
        
        .contact-info p {
            margin: 5px 0;
        }
        
        .contact-info strong {
            color: var(--pastel-pink);
        }
        
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
        }

        .free-ship-progress {
            margin: 15px 0;
            background-color: var(--dark-gray);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--light-gray);
        }
        
        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-pink);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .progress-percent {
            position: absolute;
            top: -20px;
            right: 0;
            font-size: 0.8rem;
            color: var(--pastel-pink);
        }
        
        .hair-options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .hair-option-box {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            border: 1px solid var(--light-gray);
        }
        
        .hair-option-title {
            font-size: 1rem;
            margin-bottom: 12px;
            text-align: center;
            color: var(--light-pastel-pink);
            font-weight: 600;
        }
        
        .hair-option-note {
            font-size: 0.85rem;
            color: var(--light-pastel-pink);
            text-align: center;
            margin-bottom: 10px;
        }

        .option-quantity {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            width: 100%;
        }
        
        .quantity-btn {
            width: 25px;
            height: 25px;
            background-color: var(--pink);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        .quantity-input {
            width: 30px;
            text-align: center;
            margin: 0 5px;
            background-color: var(--dark-gray);
            color: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            padding: 2px;
        }
        
        .quantity-info {
            font-size: 0.7rem;
            color: var(--light-pastel-pink);
            text-align: center;
            margin-top: 5px;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
            
            .background-customization {
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                gap: 25px;
            }
            
            .background-note {
                order: 1;
            }
            
            .preview-container {
                order: 2;
                min-height: 400px;
            }
            
            .background-options {
                order: 3;
            }

            .character-options {
                flex-direction: row;
            }

            .hair-options-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .discount-section {
                flex-direction: row;
            }
        }
        
        @media (max-width: 767px) {
            html, body {
                background-attachment: scroll;
            }
            
            .steps-container::before {
                top: 20px;
                left: 5%;
                width: 90%;
            }
            
            .step-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .step-title {
                font-size: 0.75rem;
            }
            
            .version-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .version-option {
                padding: 15px;
            }
            
            .version-header h3 {
                font-size: 1.2rem;
            }
            
            .version-price {
                font-size: 1.4rem;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .btn-primary-custom {
                padding: 14px 28px;
                font-size: 1rem;
            }
            
            .hero-icons {
                gap: 15px;
            }
            
            .hero-icon {
                font-size: 1.5rem;
            }
            
            .featured-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .feature-icon {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .hair-options-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .options-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .option-thumbnail {
                width: 70px;
                height: 70px;
            }
            
            .tagline {
                font-size: 1.5rem;
            }
            
            .sub-tagline {
                font-size: 1rem;
            }
            
            .benefits-container {
                gap: 15px;
            }
            
            .benefit-item {
                max-width: 100px;
            }
            
            .character-options {
                flex-direction: column;
            }
            
            .version-price {
                font-size: 1.3rem;
            }
            
            .logo-image {
                height: 70px;
            }
            
            .confirmation-buttons {
                flex-direction: column;
            }
            
            .checkout-form {
                padding: 15px;
            }
            
            .form-group input, 
            .form-group textarea, 
            .form-group select {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .cta-button {
                padding: 14px;
                font-size: 1rem;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="save-indicator">
        <i class="fas fa-save"></i> Đã lưu lựa chọn
    </div>
    
    <div class="modal" id="image-modal">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="zoomed-image" loading="lazy">
    </div>
    
    <div class="popup-overlay" id="popup-overlay"></div>
    
    <div class="confirmation-popup" id="confirmation-popup">
        <div class="confirmation-content">
            <i class="fas fa-check-circle confirmation-icon"></i>
            <div class="confirmation-title">Đặt hàng thành công!</div>
            <div class="confirmation-subtitle">Cảm ơn bạn đã chọn L'Gôu để gửi gắm món quà đặc biệt!</div>
            
            <div class="customer-info">
                <p><span class="info-label">Tên KH:</span> <span id="customer-name-display">Nguyễn Văn A</span></p>
                <p><span class="info-label">SĐT:</span> <span id="customer-phone-display">0987654321</span></p>
                <p><span class="info-label">Địa chỉ:</span> <span id="customer-address-display">123 Đường ABC, Hà Nội</span></p>
                <p><span class="info-label">Ngày nhận:</span> <span id="delivery-date-display">15/07</span></p>
            </div>
            
            <p>Vui lòng liên hệ với shop để xác nhận đơn hàng.</p>
            
            <div class="contact-info">
                <p>Liên hệ với shop qua:</p>
                <p><strong>Facebook:</strong> <a href="https://www.facebook.com/lgou.official" target="_blank">theluvingifts</a></p>
                <p><strong>Instagram:</strong> <a href="https://www.instagram.com/lgou.official/" target="_blank">lgou.official</a></p>
            </div>
            
            <div class="confirmation-buttons">
                <button class="confirmation-button facebook" id="popup-facebook">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
                <button class="confirmation-button instagram" id="popup-instagram">
                    <i class="fab fa-instagram"></i> Instagram
                </button>
                <button class="confirmation-button primary popup-close">Đóng</button>
            </div>
        </div>
    </div>
    
    <header class="header">
        <div class="navbar">
            <a href="#" class="logo">
                <img src="https://i.postimg.cc/7YKWGsqK/logo-L-Go-u-tra-ng-page-0001.jpg" 
                     alt="L'Gôu Logo" 
                     class="logo-image">
            </a>
        </div>
        
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Tạo Kỷ Niệm Cùng Khung Tranh LEGO</h1>
                <p class="hero-subtitle">Tạo khung tranh độc đáo với nhân vật LEGO và chủ đề yêu thích của bạn</p>
                <button class="btn-primary-custom" onclick="document.getElementById('step-content').scrollIntoView({behavior: 'smooth'})">
                    <i class="fas fa-magic"></i> Bắt Đầu Tạo
                </button>
                <div class="hero-icons">
                    <i class="fas fa-cube hero-icon"></i>
                    <i class="fas fa-heart hero-icon"></i>
                    <i class="fas fa-star hero-icon"></i>
                    <i class="fas fa-camera hero-icon"></i>
                </div>
            </div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
        </div>

        <!-- Featured Products -->
        <div class="featured-section">
            <div class="container">
                <h2 class="featured-title">
                    <i class="fas fa-star"></i> Sản Phẩm Nổi Bật
                </h2>
                <div class="featured-grid">
                    <div class="product-card">
                        <div class="product-image">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">
                                <i class="fas fa-user"></i> 1 Minifigure
                            </h3>
                            <p class="product-desc">Hoàn hảo cho hiển thị nhân vật đơn</p>
                            <p class="product-price">
                                <i class="fas fa-tag"></i> 189.000₫
                            </p>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="product-image">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">
                                <i class="fas fa-users"></i> 2 Minifigures
                            </h3>
                            <p class="product-desc">Hiển thị cặp đôi yêu thích của bạn</p>
                            <p class="product-price">
                                <i class="fas fa-tag"></i> 199.000₫
                            </p>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="features-section">
            <div class="container">
                <div class="features-grid">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <h4><i class="fas fa-check-circle"></i> Tùy Chỉnh Hoàn Toàn</h4>
                        <p>Cá nhân hóa mọi khía cạnh theo ý bạn</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <h4><i class="fas fa-check-circle"></i> Quà Tặng Hoàn Hảo</h4>
                        <p>Món quà đáng nhớ cho mọi dịp đặc biệt</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4><i class="fas fa-check-circle"></i> Chất Lượng Đảm Bảo</h4>
                        <p>Vật liệu cao cấp, bảo hành 1 đổi 1</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Thanh điều hướng các bước -->
    <div class="steps-container">
        <div class="step active" data-step="1">
            <div class="step-icon"><i class="fas fa-star"></i></div>
            <div class="step-title">Collection</div>
        </div>
        <div class="step" data-step="2">
            <div class="step-icon"><i class="fas fa-box-open"></i></div>
            <div class="step-title">Chọn Version</div>
        </div>
        <div class="step" data-step="3">
            <div class="step-icon"><i class="fas fa-image"></i></div>
            <div class="step-title">Chọn Background</div>
        </div>
        <div class="step" data-step="4">
            <div class="step-icon"><i class="fas fa-user"></i></div>
            <div class="step-title">Nhân vật</div>
        </div>
        <div class="step" data-step="5">
            <div class="step-icon"><i class="fas fa-paw"></i></div>
            <div class="step-title">Phụ kiện & Thú cưng</div>
        </div>
        <div class="step" data-step="6">
            <div class="step-icon"><i class="fas fa-file-alt"></i></div>
            <div class="step-title">Thông tin đặt hàng</div>
        </div>
    </div>

    <section class="section" id="step-content">
        <div class="container">
            <h2 class="section-title">Tạo Tranh Lego Theo Ý Bạn</h2>
            
            <div class="step-content">
                <!-- Bước 1: Chọn Collection -->
                <div class="step-pane active" id="step-1">
                    <div class="collection-selector">
                        <h3 class="collection-title">
                            <i class="fas fa-star"></i> Chọn Collection Đặc Biệt
                        </h3>
                        <p class="collection-subtitle">Các bộ sưu tập limited edition cho những dịp đặc biệt</p>
                        <!-- Selected collection indicator -->
                        <div id="selected-collection-indicator" style="display:none; text-align:center; margin:-10px 0 20px 0;">
                            <span style="display:inline-flex; align-items:center; gap:8px; background:rgba(0,0,0,0.08); color:var(--text-dark); border-radius:999px; padding:8px 14px; font-weight:600;">
                                <i class="fas fa-check-circle" style="color:#2ecc71;"></i>
                                <span>Đang chọn: <span id="selected-collection-name">—</span></span>
                            </span>
                        </div>
                        
                        <div class="collection-options" id="collection-options">
                            <!-- Collections will be populated by JavaScript -->
                        </div>
                        
                        <div class="regular-collection">
                            <div class="collection-card regular" data-collection="regular">
                                <div class="collection-header">
                                    <h4>Bộ Sưu Tập Thường</h4>
                                    <div class="collection-status available">Luôn có sẵn</div>
                                </div>
                                <div class="collection-description">
                                    Tất cả các tùy chọn thiết kế thông thường với đầy đủ tính năng tùy chỉnh
                                </div>
                                <div class="collection-features">
                                    <span class="feature-tag">Tùy chỉnh tự do</span>
                                    <span class="feature-tag">Không giới hạn thời gian</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="refreshCollections()" style="
                                background: var(--button-gradient);
                                color: white;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 20px;
                                cursor: pointer;
                                font-size: 0.9rem;
                                transition: all 0.3s ease;
                            ">
                                <i class="fas fa-sync"></i> Cập nhật Collections
                            </button>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn" disabled>Quay lại</button>
                        <button class="step-btn next-btn">Tiếp theo</button>
                    </div>
                </div>
                
                <!-- Bước 2: Chọn Version -->
                <div class="step-pane" id="step-2">
                    <div class="version-selector">
                        <div class="version-options">
                            <div class="version-option active" data-version="1" data-price="189000">
                                <div class="version-header">
                                    <h3>Version 1</h3>
                                    <div class="version-price">189.000₫</div>
                                </div>
                                <div class="version-features">
                                    <p class="version-subtitle">1 Lego (Nhân vật)</p>
                                    <ul>
                                        <li>Khung tranh với <strong>01 Lego</strong></li>
                                        <li>Thiệp L'Gôu</li>
                                        <li>Thiệp viết tay</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="version-option" data-version="2" data-price="199000">
                                <div class="version-header">
                                    <h3>Version 2</h3>
                                    <div class="version-price">199.000₫</div>
                                </div>
                                <div class="version-features">
                                    <p class="version-subtitle">2 Lego (Nhân vật)</p>
                                    <ul>
                                        <li>Khung tranh với <strong>02 Lego</strong></li>
                                        <li>Thiệp L'Gôu</li>
                                        <li>Thiệp viết tay</li>
                                    </ul>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn">Quay lại</button>
                        <button class="step-btn next-btn">Tiếp theo</button>
                    </div>
                </div>
                
                <!-- Bước 3: Chọn Background -->
                <div class="step-pane" id="step-3">
                    <div class="background-customization">
                        <div class="background-note">
                            <label for="background-note">Ghi chú cho background (VD: Đổi chữ từ "abc" sang "xyz", nếu có custom riêng thì gắn link drive)  <span class="required-star">*</span></label>
                            <textarea id="background-note" placeholder="Vui lòng mô tả chi tiết yêu cầu thiết kế background..." required></textarea>
                        </div>
                        
                        <div class="preview-container" id="zoom-image">
                            <img src="https://inhjan0elby3ojxf.public.blob.vercel-storage.com/logo%20L%27Go%CC%82u%20tra%CC%86%CC%81ng_page-0001%20%282%29.jpg" 
                                 alt="Preview sản phẩm" 
                                 class="main-image" 
                                 id="main-default" 
                                 loading="lazy">
                        </div>
                        
                        <div class="background-options">
                            <h3 class="options-title"><i class="fas fa-image"></i> Nền (Thiết Kế Theo Yêu Cầu) </h3>
                            <div class="options-grid" id="background-grid"></div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn">Quay lại</button>
                        <button class="step-btn next-btn">Tiếp theo</button>
                    </div>
                </div>
                
                <!-- Bước 4: Chọn Nhân vật -->
                <div class="step-pane" id="step-4">
                    <div class="options-container">
                        <div class="options-section" id="clothing-section">
                            <h3 class="options-title"><i class="fas fa-tshirt"></i> Áo & Quần</h3>
                            <div class="character-options" id="character-container"></div>
                        </div>
                        
                        <div class="options-section">
                            <h3 class="options-title"><i class="fas fa-smile"></i> Khuôn Mặt</h3>
                            <p style="margin-bottom: 12px; color: var(--light-pastel-pink); text-align: center;">
                                <i class="fas fa-gift"></i> Miễn phí lựa chọn
                            </p>
                            <!-- Debug button -->
                            <button onclick="forceRefreshProducts()" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; margin-bottom: 10px;">🔄 Refresh Products</button>
                            <div class="options-grid" id="face-grid"></div>
                            <div class="max-selection-info" id="face-selection-info" style="text-align: center; color: var(--light-pastel-pink); font-size: 0.85rem; margin-top: 5px;">(Chọn tối đa 1 khuôn mặt)</div>
                        </div>
                        
                        <div class="options-section">
                            <h3 class="options-title"><i class="fas fa-user"></i> Tóc</h3>
                            
                            <div class="hair-options-container" id="hair-options-container"></div>
                        </div>
                        
                        <div class="options-section">
                            <h3 class="options-title" id="hats-title">
                                <i class="fas fa-hat-cowboy"></i> Mũ
                            </h3>
                            <div class="hat-section" id="hat-section">
                                <p class="hat-note" style="color: var(--light-pastel-pink); text-align: center; margin-bottom: 10px;">Chọn mũ – bấm để chọn/nhấn lại để bỏ chọn</p>
                                <div class="options-grid" id="hat-grid"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn">Quay lại</button>
                        <button class="step-btn next-btn">Tiếp theo</button>
                    </div>
                </div>
                
                <!-- Bước 5: Chọn Phụ kiện & Thú cưng -->
                <div class="step-pane" id="step-5">
                    <div class="options-container">
                        <div class="options-section">
                            <h3 class="options-title"><i class="fas fa-mobile-alt"></i> Phụ Kiện</h3>
                            <div class="options-grid" id="accessory-grid"></div>
                            <div class="quantity-info">(Nhấp chọn phụ kiện rồi điều chỉnh số lượng)</div>
                        </div>
                        
                        <div class="options-section">
                            <h3 class="options-title"><i class="fas fa-paw"></i> Thú Cưng</h3>
                            <div class="options-grid" id="pet-grid"></div>
                            <div class="quantity-info">(Nhấp chọn thú cưng rồi điều chỉnh số lượng)</div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn">Quay lại</button>
                        <button class="step-btn next-btn">Tiếp theo</button>
                    </div>
                </div>
                
                <!-- Bước 6: Thông tin đặt hàng -->
                <div class="step-pane" id="step-6">
                    <div class="order-summary">
                        <h3 class="summary-title">ĐƠN HÀNG CỦA BẠN</h3>
                        <div class="summary-items" id="order-summary"></div>
                        
                <div class="free-ship-progress" id="free-ship-progress" style="display:none"></div>
                        
                        <div class="discount-section">
                            <div class="discount-toggle" id="discount-toggle">
                                <i class="fas fa-tag"></i>
                                <span>Áp dụng mã giảm giá</span>
                            </div>
                            
                            <div class="discount-form" id="discount-form">
                                <input type="text" class="discount-input" placeholder="Nhập mã giảm giá" id="discount-code">
                                <button class="apply-button" id="apply-discount">Áp dụng</button>
                            </div>
                        </div>
                        
                        <div class="discount-result valid" id="discount-result">
                            Bạn tiết kiệm: 30.500₫ - Thanh toán: 274.500₫
                        </div>
                    </div>
                    
                    <div class="checkout-form">
                        <h3 class="form-title">Thông tin đặt hàng</h3>
                        
                        <form class="customer-form" id="customer-form">
                            <div class="form-group">
                                <label for="customer-name">Họ và tên <span class="required-star">*</span></label>
                                <input type="text" id="customer-name" name="name" required>
                                <div class="form-error" id="name-error">Vui lòng nhập họ tên</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customer-phone">Số điện thoại <span class="required-star">*</span></label>
                                <input type="tel" id="customer-phone" name="phone" required>
                                <div class="form-error" id="phone-error">Vui lòng nhập số điện thoại</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customer-address">Địa chỉ nhận hàng <span class="required-star">*</span></label>
                                <input type="text" id="customer-address" name="address" required>
                                <div class="form-error" id="address-error">Vui lòng nhập địa chỉ</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customer-instagram">Tên Instagram <span class="required-star">*</span></label>
                                <input type="text" id="customer-instagram" name="instagram" placeholder="@ten_instagram" required>
                                <div class="form-error" id="instagram-error">Vui lòng nhập tên Instagram</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="delivery-date">Ngày nhận hàng <span class="required-star">*</span></label>
                                <div class="date-picker-container">
                                <input
                                    type="text"
                                    id="delivery-date"
                                    name="delivery_date"
                                        class="date-picker-input"
                                        placeholder="Chọn ngày nhận hàng"
                                        readonly
                                    required
                                >
                                    <div class="date-picker-calendar" id="date-picker-calendar">
                                        <div class="calendar-header">
                                            <button type="button" class="calendar-nav" id="prev-month">‹</button>
                                            <div class="calendar-month-year" id="calendar-month-year"></div>
                                            <button type="button" class="calendar-nav" id="next-month">›</button>
                                        </div>
                                        <div class="calendar-grid" id="calendar-grid">
                                            <!-- Calendar will be generated by JavaScript -->
                                        </div>
                                        <div class="date-info">
                                            <i class="fas fa-info-circle"></i> Ngày nhận hàng tối thiểu là 3 ngày kể từ hôm nay
                                        </div>
                                    </div>
                                </div>
                                <div class="form-error" id="delivery-date-error">
                                    Vui lòng chọn ngày nhận hàng (tối thiểu 3 ngày từ hôm nay).
                                </div>
                            </div> 

                            <div class="form-group">
                                <label for="customer-email">Email <span class="required-star">*</span></label>
                                <input type="email" id="customer-email" name="email" required>
                                <div class="form-error" id="email-error">Vui lòng nhập email</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customer-note">Ghi chú</label>
                                <textarea id="customer-note" name="note" rows="3"></textarea>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="policy-agreement" required>
                                <label for="policy-agreement">Tôi đồng ý với <a href="#" class="policy-link">chính sách bảo hành & điều khoản</a> của L'Gôu</label>
                            </div>
                            
                            <button type="button" class="cta-button" id="confirm-button">
                                <span id="order-text">Đặt hàng ngay</span>
                                <i class="fas fa-spinner spinner" id="order-spinner"></i>
                            </button>
                        </form>
                    </div>
                    
                    <div class="step-actions">
                        <button class="step-btn prev-btn">Quay lại</button>
                        <button class="step-btn next-btn" style="display: none;">Tiếp theo</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <footer class="footer">
        <div class="container">
            
            <div class="copyright">
                © 2025 L'Gôu. Đã đăng ký bản quyền.
            </div>
        </div>
    </footer>

    <!-- Form ẩn để gửi email -->
<script>
    // Dữ liệu collections - Default data
    let collections = {
        womensday: {
            id: 'womensday',
            name: 'Happy Women\'s Day 20.10',
            description: 'Celebrate inspiring women with this special collection. Featuring empowering themes and elegant designs.',
            icon: 'fas fa-female',
            status: 'active', // active, expired
            endDate: '2024-10-25T23:59:59', // ISO format
            limitedProducts: [
                { id: 'wd_bg1', label: 'Women Power Background', image: 'https://example.com/women-bg1.jpg', type: 'background' },
                { id: 'wd_acc1', label: 'Crown Accessory', image: 'https://example.com/crown.jpg', type: 'accessory', price: 15000 },
                { id: 'wd_hair1', label: 'Elegant Hair Style', image: 'https://example.com/elegant-hair.jpg', type: 'hair', price: 25000 }
            ],
            features: ['Thiết kế đặc biệt', 'Phiên bản giới hạn', 'Tặng kèm thiệp chúc mừng'],
            discount: 10 // 10% discount
        },
        valentine: {
            id: 'valentine',
            name: 'Valentine Collection 2024',
            description: 'Romantic designs perfect for couples and love celebrations.',
            icon: 'fas fa-heart',
            status: 'active',
            endDate: '2024-02-20T23:59:59',
            limitedProducts: [
                { id: 'vl_bg1', label: 'Love Story Background', image: 'https://example.com/love-bg.jpg', type: 'background' },
                { id: 'vl_acc1', label: 'Heart Necklace', image: 'https://example.com/heart-necklace.jpg', type: 'accessory', price: 12000 }
            ],
            features: ['Thiết kế lãng mạn', 'Màu hồng đặc biệt', 'Box quà Valentine'],
            discount: 15
        },
        christmas: {
            id: 'christmas',
            name: 'Christmas Magic 2024',
            description: 'Festive holiday collection with Christmas themes and winter wonderland designs.',
            icon: 'fas fa-tree',
            status: 'expired',
            endDate: '2023-12-31T23:59:59',
            limitedProducts: [
                { id: 'xm_bg1', label: 'Christmas Tree Background', image: 'https://example.com/xmas-bg.jpg', type: 'background' },
                { id: 'xm_hat1', label: 'Santa Hat', image: 'https://example.com/santa-hat.jpg', type: 'hat', price: 18000 }
            ],
            features: ['Chủ đề Giáng sinh', 'Màu đỏ xanh truyền thống', 'Tặng kèm card Noel'],
            discount: 20
        }
    };
    
    // Load inventory stock from CMS
    let cmsInventory = [];
    
    function loadInventoryFromCMS() {
        const savedInventory = localStorage.getItem('lgou_inventory');
        if (savedInventory) {
            try {
                cmsInventory = JSON.parse(savedInventory);
                console.log('Loaded inventory from CMS:', cmsInventory.length, 'items');
            } catch (error) {
                console.error('Error loading inventory from CMS:', error);
                cmsInventory = [];
            }
        }
    }
    
    function getInventoryStock(productId) {
        return cmsInventory.find(item => item.id === productId);
    }
    
    function updateInventoryStock(productId, quantityUsed = 1) {
        const item = cmsInventory.find(item => item.id === productId);
        if (item && item.stock > 0) {
            item.stock -= quantityUsed;
            localStorage.setItem('lgou_inventory', JSON.stringify(cmsInventory));
            return true;
        }
        return false;
    }

    // Load collections from Supabase
    async function loadCollectionsFromSupabase() {
        try {
            console.log('🔄 Fetching collections from Supabase...');
            const response = await fetch('/api/collections?status=active');
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch collections');
            }
            
            const fetchedCollections = data.collections || [];
            console.log('✅ Fetched collections:', fetchedCollections.length);
            
            // Convert array to object keyed by id
            collections = {};
            fetchedCollections.forEach(col => {
                const cleanId = col.id.trim();
                collections[cleanId] = {
                    id: cleanId,
                    name: col.name,
                    description: col.description,
                    endDate: col.end_date,
                    discount: col.discount || 0,
                    icon: col.icon || 'fas fa-star',
                    features: col.features || [],
                    limitedProducts: col.limited_products || [],
                    status: col.status
                };
            });
            
            console.log('✅ Loaded collections:', collections);
            renderCollections();
            
            } catch (error) {
            console.error('❌ Error loading collections from Supabase:', error);
            // Keep default collections if fetch fails
            }
        }
    
    // Legacy function for backward compatibility
    function loadCollectionsFromCMS() {
        loadCollectionsFromSupabase();
    }
    
    // Listen for changes in localStorage (from CMS updates)
    function setupCollectionSync() {
        // Listen for storage events (when CMS updates localStorage)
        window.addEventListener('storage', function(e) {
            if (e.key === 'lgou_collections') {
                console.log('Collections updated by CMS, refreshing...');
                loadCollectionsFromCMS();
                renderCollections();
                startCollectionTimers();
            }
        });
        
        // Also check for changes periodically (for same-origin updates)
        let lastCollectionsData = localStorage.getItem('lgou_collections');
        setInterval(() => {
            const currentData = localStorage.getItem('lgou_collections');
            if (currentData !== lastCollectionsData) {
                console.log('Collections changed, refreshing...');
                loadCollectionsFromCMS();
                renderCollections();
                startCollectionTimers();
                lastCollectionsData = currentData;
            }
        }, 2000); // Check every 2 seconds
    }
    
    // Manual refresh function
    async function refreshCollections() {
        console.log('Manually refreshing collections...');
        
        // Show feedback
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-sync fa-spin"></i> Đang cập nhật...';
        
        await loadCollectionsFromSupabase();
        startCollectionTimers();
        
        btn.innerHTML = '<i class="fas fa-check"></i> Đã cập nhật!';
        btn.style.background = 'var(--success-green)';
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = 'var(--button-gradient)';
        }, 2000);
    }

    // Dynamic product options - will be populated from Supabase
    // Dynamic product options - will be populated from Supabase
    let productOptions = {
        // All categories will be populated from Supabase
        backgrounds: [],
        faces: [],
        maleHairs: [],
        femaleHairs: [],
        hats: [],
        accessories: [],
        pets: []
    };

    // Cache management
    const CACHE_KEYS = {
        PRODUCTS: 'lgou_products_cache',
        PRODUCTS_TIMESTAMP: 'lgou_products_timestamp',
        COLLECTIONS: 'lgou_collections_cache',
        COLLECTIONS_TIMESTAMP: 'lgou_collections_timestamp'
    };

    const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes in milliseconds

    // Cache utilities
    function setCache(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify({
                data: data,
                timestamp: Date.now()
            }));
        } catch (error) {
            console.warn('Cache storage failed:', error);
        }
    }

    function getCache(key) {
        try {
            const cached = localStorage.getItem(key);
            if (!cached) return null;
            
            const parsed = JSON.parse(cached);
            const isExpired = Date.now() - parsed.timestamp > CACHE_DURATION;
            
            if (isExpired) {
                localStorage.removeItem(key);
                return null;
            }
            
            return parsed.data;
        } catch (error) {
            console.warn('Cache retrieval failed:', error);
            return null;
        }
    }

    function clearCache() {
        Object.values(CACHE_KEYS).forEach(key => {
            localStorage.removeItem(key);
        });
    }

    // Mã giảm giá hợp lệ
    const validDiscountCodes = {
        'GRADUATION': { type: 'fixed', value: 20000 },
    };

    // Collection management functions
    function isCollectionActive(collection) {
        if (collection.status === 'expired') return false;
        const now = new Date();
        const endDate = new Date(collection.endDate);
        return now < endDate;
    }
    
    function getTimeRemaining(endDate) {
        const now = new Date();
        const end = new Date(endDate);
        const total = end - now;
        
        if (total <= 0) return null;
        
        const days = Math.floor(total / (1000 * 60 * 60 * 24));
        const hours = Math.floor((total % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((total % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((total % (1000 * 60)) / 1000);
        
        return { total, days, hours, minutes, seconds };
    }
    
    function formatTimeRemaining(timeObj) {
        if (!timeObj) return 'Đã hết hạn';
        
        const { days, hours, minutes, seconds } = timeObj;
        if (days > 0) return `${days}d ${hours}h ${minutes}m`;
        if (hours > 0) return `${hours}h ${minutes}m ${seconds}s`;
        return `${minutes}m ${seconds}s`;
    }
    
    function createCollectionCard(collection) {
        const isActive = true; // Allow selecting any collection card
        const timeRemaining = getTimeRemaining(collection.endDate);
        
        const card = document.createElement('div');
        card.className = `collection-card limited ${isActive ? 'active' : 'expired'}`;
        card.dataset.collection = collection.id.trim();
        
        card.innerHTML = `
            <div class="collection-header">
                <h4><i class="${collection.icon}"></i> ${collection.name}</h4>
                <div class="collection-status ${isActive ? 'limited' : 'expired'}">
                    ${isActive ? 'Limited' : 'Expired'}
                </div>
            </div>
            <div class="collection-description">${collection.description}</div>
            ${isActive && timeRemaining ? `
                <div class="collection-timer">
                    <div class="timer-label">Thời gian còn lại:</div>
                    <div class="timer-display" data-end-date="${collection.endDate}">
                        ${formatTimeRemaining(timeRemaining)}
                    </div>
                </div>
            ` : ''}
            <div class="collection-features">
                ${collection.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                ${collection.discount ? `<span class="feature-tag">Giảm ${collection.discount}%</span>` : ''}
            </div>
        `;
        
            // Add click event listener
        card.addEventListener('click', (e) => {
            e.preventDefault();
            console.log('🎯 Collection card clicked:', collection.id);
            selectCollection(collection.id);
        });
        
        return card;
    }
    
    function renderCollections() {
        console.log('🎨 renderCollections called');
        const container = document.getElementById('collection-options');
        if (!container) {
            console.log('❌ Collection options container not found');
            return;
        }
        container.innerHTML = '';
        
        console.log('📦 Collections to render:', Object.keys(collections));
        Object.values(collections).forEach(collection => {
            console.log('🎯 Creating card for collection:', collection.id);
            const card = createCollectionCard(collection);
            container.appendChild(card);
        });
        
        // Ensure regular card is clickable
        const regularCard = document.querySelector('.regular-collection .collection-card.regular');
        if (regularCard && !regularCard.dataset._bound) {
            regularCard.addEventListener('click', () => selectCollection('regular'));
            regularCard.dataset._bound = 'true';
        }
        
        // Respect existing selection; only default to regular if none selected
        const current = window.selectedCollection;
        if (!current) {
        selectCollection('regular');
        } else {
            // Re-apply active class to current selection after re-render
            const selectedCard = document.querySelector(`[data-collection="${current}"]`);
            if (selectedCard) selectedCard.classList.add('active');
        }
    }
    
    function selectCollection(collectionId) {
        // Trim whitespace and newlines from collection ID
        collectionId = collectionId.trim();
        console.log('🎯 selectCollection called with:', collectionId);
        
        // Remove active class from all cards
        document.querySelectorAll('.collection-card').forEach(card => {
            card.classList.remove('active');
        });
        
        // Add active class to selected card
        const selectedCard = document.querySelector(`[data-collection="${collectionId}"]`);
        console.log('🔍 Selected card found:', selectedCard);
        if (selectedCard) {
            selectedCard.classList.add('active');
            console.log('✅ Active class added to card');
        } else {
            console.log('❌ No card found for collection:', collectionId);
        }
        
        // Update global selected collection
        window.selectedCollection = collectionId;
        console.log('💾 Global selectedCollection set to:', collectionId);
        
        // Update selected collection UI indicator
        try {
            const indicator = document.getElementById('selected-collection-indicator');
            const nameEl = document.getElementById('selected-collection-name');
            const col = collections[collectionId];
            if (indicator && nameEl) {
                nameEl.textContent = col?.name || (collectionId === 'regular' ? 'Bộ Sưu Tập Thường' : collectionId);
                indicator.style.display = 'block';
            }
        } catch (e) {
            console.warn('Could not update selected collection indicator:', e);
        }

        // Fetch products for the selected collection from Supabase
        console.log(`🎯 Collection selected: ${collectionId}`);
        fetchProductsFromSupabase(true, collectionId);
        
        // Save selection
        saveSelections();
    }
    
    function updateProductsForCollection(collectionId) {
        if (collectionId === 'regular') {
            // Use regular products - no changes needed
            return;
        }
        
        const collection = collections[collectionId];
        if (!collection || !isCollectionActive(collection)) return;
        
        // Add limited products to respective categories
        collection.limitedProducts.forEach(product => {
            switch(product.type) {
                case 'background':
                    if (!productOptions.backgrounds.find(bg => bg.id === product.id)) {
                        productOptions.backgrounds.unshift(product);
                    }
                    break;
                case 'accessory':
                    if (!productOptions.accessories.find(acc => acc.id === product.id)) {
                        productOptions.accessories.unshift(product);
                    }
                    break;
                case 'hair':
                    if (!productOptions.maleHairs.find(hair => hair.id === product.id)) {
                        productOptions.maleHairs.unshift(product);
                        productOptions.femaleHairs.unshift(product);
                    }
                    break;
                case 'hat':
                    if (!productOptions.hats.find(hat => hat.id === product.id)) {
                        productOptions.hats.unshift(product);
                    }
                    break;
            }
        });
        
        // Re-render affected sections
        renderOptions(document.getElementById('background-grid'), productOptions.backgrounds, 'background');
        renderOptions(document.getElementById('accessory-grid'), productOptions.accessories, 'accessory');
        renderOptions(document.getElementById('hat-grid'), productOptions.hats, 'hat');
        createHairOptions();
    }
    
    function startCollectionTimers() {
        const timerElements = document.querySelectorAll('.timer-display[data-end-date]');
        
        const updateTimers = () => {
            timerElements.forEach(element => {
                const endDate = element.dataset.endDate;
                const timeRemaining = getTimeRemaining(endDate);
                element.textContent = formatTimeRemaining(timeRemaining);
                
                if (!timeRemaining) {
                    // Collection expired, refresh the page or update UI
                    element.closest('.collection-card').classList.add('expired');
                    element.closest('.collection-card').classList.remove('active');
                }
            });
        };
        
        // Update every second
        setInterval(updateTimers, 1000);
    }

    // Hàm tạo option item
    function createOptionItem(option, category) {
        const item = document.createElement('div');
        item.className = 'option-item';
        item.dataset.id = option.id;
        item.dataset.category = category;
        item.dataset.price = option.price;
        item.dataset.label = option.label;
        
        if (category === 'background') {
            item.dataset.image = option.image;
        }

        const thumbnail = document.createElement('div');
        thumbnail.className = 'option-thumbnail';
        
        if (category === 'background') {
            thumbnail.style.backgroundImage = `url('${option.image}')`;
            thumbnail.style.backgroundSize = 'cover';
            thumbnail.style.backgroundPosition = 'center';
        } else {
            const img = document.createElement('img');
            img.src = option.image;
            img.alt = option.label;
            img.loading = 'lazy';
            thumbnail.appendChild(img);
        }

        const name = document.createElement('div');
        name.className = 'option-name';
        name.textContent = option.label;

        // Add stock display
        const stockDiv = document.createElement('div');
        stockDiv.className = 'option-stock';
        const inventoryItem = getInventoryStock(option.id);
        const stock = inventoryItem ? inventoryItem.stock : 999;
        const isOutOfStock = stock <= 0;
        
        if (isOutOfStock) {
            stockDiv.innerHTML = '<span style="color: #f44336; font-weight: bold; font-size: 0.8rem;">Hết hàng</span>';
            item.classList.add('out-of-stock');
        } else if (stock <= 5) {
            stockDiv.innerHTML = `<span style="color: #ff9800; font-weight: bold; font-size: 0.8rem;">Còn ${stock}</span>`;
        } else {
            stockDiv.innerHTML = `<span style="color: #4CAF50; font-size: 0.8rem;">Còn ${stock}</span>`;
        }

        item.appendChild(thumbnail);
        item.appendChild(name);
        item.appendChild(stockDiv);

        if (option.price > 0) {
            const price = document.createElement('div');
            price.className = 'option-price';
            price.textContent = `+${option.price.toLocaleString()}₫`;
            item.appendChild(price);
        }
        
        if (category === 'accessory' || category === 'pet' || category === 'hat') {
            const quantityContainer = document.createElement('div');
            quantityContainer.className = 'option-quantity';
            quantityContainer.style.display = 'none';
            
            const minusBtn = document.createElement('button');
            minusBtn.className = 'quantity-btn minus';
            minusBtn.textContent = '-';
            minusBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const input = quantityContainer.querySelector('.quantity-input');
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                    updateQuantity(input, item, option);
                }
            });
            
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'quantity-input';
            input.value = '1';
            input.min = '1';
            input.max = '10';
            input.addEventListener('change', function(e) {
                e.stopPropagation();
                updateQuantity(this, item, option);
            });
            
            const plusBtn = document.createElement('button');
            plusBtn.className = 'quantity-btn plus';
            plusBtn.textContent = '+';
            plusBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const input = quantityContainer.querySelector('.quantity-input');
                input.value = parseInt(input.value) + 1;
                updateQuantity(input, item, option);
            });
            
            quantityContainer.appendChild(minusBtn);
            quantityContainer.appendChild(input);
            quantityContainer.appendChild(plusBtn);
            item.appendChild(quantityContainer);
        }

        return item;
    }
    
    // Hàm cập nhật số lượng
    function updateQuantity(input, item, option) {
        const value = parseInt(input.value);
        if (isNaN(value)) {
            input.value = 1;
            item.dataset.quantity = 1;
        } else {
            if (value < 1) input.value = 1;
            else if (value > 10) input.value = 10;
            item.dataset.quantity = input.value;
        }
        updateOrderSummary();
        saveSelections();
    }

    // Hàm render các option
    function renderOptions(container, options, category) {
        container.innerHTML = '';
        options.forEach(option => {
            const item = createOptionItem(option, category);
            container.appendChild(item);
        });
    }

    // Hàm tạo tùy chọn tóc
    function createHairOptions() {
        const container = document.getElementById('hair-options-container');
        
        // Clear existing content to avoid duplicates
        container.innerHTML = '';
        
        const maleHairBox = document.createElement('div');
        maleHairBox.className = 'hair-option-box';
        maleHairBox.innerHTML = `
            <div class="hair-option-title">Tóc nhân vật nam</div>
            <div class="options-grid" id="male-hair-grid"></div>
        `;
        container.appendChild(maleHairBox);
        
        const femaleHairBox = document.createElement('div');
        femaleHairBox.className = 'hair-option-box';
        femaleHairBox.innerHTML = `
            <div class="hair-option-title">Tóc nhân vật nữ</div>
            <div class="options-grid" id="female-hair-grid"></div>
        `;
        container.appendChild(femaleHairBox);
        
        renderOptions(document.getElementById('male-hair-grid'), productOptions.maleHairs, 'hair');
        renderOptions(document.getElementById('female-hair-grid'), productOptions.femaleHairs, 'hair');
    }

    // Khởi tạo các tùy chọn
    function initOptions() {
        renderOptions(document.getElementById('background-grid'), productOptions.backgrounds, 'background');
        renderOptions(document.getElementById('face-grid'), productOptions.faces, 'face');
        renderOptions(document.getElementById('hat-grid'), productOptions.hats, 'hat');
        renderOptions(document.getElementById('accessory-grid'), productOptions.accessories, 'accessory');
        renderOptions(document.getElementById('pet-grid'), productOptions.pets, 'pet');
        createHairOptions();
    }

    // Modal xem hình ảnh
    const modal = document.getElementById('image-modal');
    const modalImg = document.getElementById('zoomed-image');
    const closeModal = document.querySelector('.close-modal');
    
    document.getElementById('zoom-image').addEventListener('click', function() {
        const currentImage = document.querySelector('.preview-container img');
        modal.style.display = "flex";
        modalImg.src = currentImage.src;
    });
    
    closeModal.addEventListener('click', function() {
        modal.style.display = "none";
    });
    
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });
    
    // Template cho nhân vật
    const characterTemplate = (id, title) => `
        <div class="character-column" data-character="${id}">
            <div class="character-title">${title}</div>
            
            <div class="option-group-title">Áo:</div>
            <div class="color-options-grid">
                 <div class="color-option selected" data-code="#${id}01" style="background-color: #f8cdea;" data-color="Hồng Pastel" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}02" style="background-color: #bfc0c4;" data-color="Xám" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}03" style="background-color: #ffffff;" data-color="Trắng" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}04" style="background-color: #2f2f2f;" data-color="Đen" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}05" style="background-color: #e68fbe;" data-color="Hồng đào" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}06" style="background-color: #409acd;" data-color="Xanh dương" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}07" style="background-color: #6b55a1;" data-color="Tím" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}08" style="background-color: #e5d3a5;" data-color="Be" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}09" style="background-color: #7eaddb;" data-color="Xanh Pastel" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}10" style="background-color: #2e3551;" data-color="Xám Đậm" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}11" style="background-color: #887149;" data-color="Vàng Mơ" data-type="shirt${id}"></div>
                <div class="color-option" data-code="#${id}12" style="background-color: #55070b;" data-color="Đỏ Mận" data-type="shirt${id}"></div>
            </div>
            
            <div class="option-group-title">Quần:</div>
            <div class="color-options-grid">
                <div class="color-option selected" data-code="#${id}13" style="background-color: #f8cdea;" data-color="Hồng Pastel" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}14" style="background-color: #bfc0c4;" data-color="Xám" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}15" style="background-color: #ffffff;" data-color="Trắng" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}16" style="background-color: #2f2f2f;" data-color="Đen" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}17" style="background-color: #e68fbe;" data-color="Hồng đào" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}18" style="background-color: #409acd;" data-color="Xanh dương" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}19" style="background-color: #6b55a1;" data-color="Tím" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}20" style="background-color: #e5d3a5;" data-color="Be" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}21" style="background-color: #7eaddb;" data-color="Xanh Pastel" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}22" style="background-color: #2e3551;" data-color="Xám Đậm" data-type="pants${id}"></div>
                <div class="color-option" data-code="#${id}23" style="background-color: #887149;" data-color="Vàng Mơ" data-type="pants${id}"></div>
             </div>
        </div>
    `;
    
    // Chi tiết các version
    const versionDetails = {
        1: {
            price: "230.000₫",
            includes: [
                "Khung tranh với <span class='highlight'>01 Lego</span>",
                
                "Thiệp The Luvin",
                "Tặng box quà sang trọng"
            ]
        },
        2: {
            price: "240.000₫",
            includes: [
                "Khung tranh với <span class='highlight'>02 Lego</span>",
                
                "Thiệp viết tay",
                "Tặng hộp quà sang trọng"
            ]
        },
        3: {
            price: "245.000₫",
            includes: [
                "Khung tranh với <span class='highlight'>03 Lego</span>",
                
                "Thiệp viết tay",
                "Tặng hộp quà sang trọng"
            ]
        }
    };
    
    // Cập nhật mô tả version
    function updateVersionDescription(version) {
        const container = document.getElementById('version-description');
        const details = versionDetails[version];
        
        if (!details) return;
        
        let html = `
            <h3>Version ${version}</h3>
            <div class="version-price">${details.price}</div>
            <p></p>
            <ul class="version-includes">
        `;
        
        details.includes.forEach(item => {
            html += `<li>${item}</li>`;
        });
        
        html += `</ul>`;
        
        container.innerHTML = html;
    }
    
    // Cập nhật hiển thị nhân vật
    function updateCharacterDisplay(versionNumber = null) {
        const container = document.getElementById('character-container');
        const version = versionNumber || document.querySelector('.version-option.active')?.dataset.version || '1';
        
        container.innerHTML = '';
        
        if (version === '1') {
            container.innerHTML = characterTemplate('1', 'Nhân vật duy nhất');
        } else if (version === '2') {
            container.innerHTML = characterTemplate('1', 'Nhân vật 1 (bên trái)');
            container.innerHTML += characterTemplate('2', 'Nhân vật 2 (bên phải)');
        } else if (version === '3') {
            container.innerHTML = characterTemplate('1', 'Nhân vật 1');
            container.innerHTML += characterTemplate('2', 'Nhân vật 2');
            container.innerHTML += characterTemplate('3', 'Nhân vật 3');
        }
        
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                const type = this.dataset.type;
                const siblings = this.parentElement.querySelectorAll(`.color-option[data-type="${type}"]`);
                siblings.forEach(sib => sib.classList.remove('selected'));
                this.classList.add('selected');
                updateOrderSummary();
                saveSelections();
            });
        });
    }
    
    // Xử lý click version options
    document.querySelectorAll('.version-option').forEach(option => {
        option.addEventListener('click', function() {
            // Remove active class from all options
            document.querySelectorAll('.version-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Add active class to clicked option
            this.classList.add('active');
            
            const version = this.dataset.version;
            updateCharacterDisplay(version);
            
            const maxFaces = parseInt(version);
            document.getElementById('face-selection-info').textContent = `(Chọn tối đa ${maxFaces} khuôn mặt)`;
            
            const selectedFaces = document.querySelectorAll('.options-section:nth-child(3) .option-item.selected');
            if (selectedFaces.length > maxFaces) {
                for (let i = maxFaces; i < selectedFaces.length; i++) {
                    selectedFaces[i].classList.remove('selected');
                }
            }
            
            updateOrderSummary();
            saveSelections();
        });
    });
    
    // Xử lý click chọn option
    document.addEventListener('click', function(e) {
        const optionItem = e.target.closest('.option-item');
        if (!optionItem) return;
        
        const category = optionItem.dataset.category;
        const section = optionItem.closest('.options-section');
        
        if (category === 'background') {
            const siblings = document.querySelectorAll('#background-grid .option-item');
            siblings.forEach(sib => sib.classList.remove('selected'));
            optionItem.classList.add('selected');
            
            // Cập nhật hình ảnh preview
            const imageUrl = optionItem.dataset.image;
            document.querySelectorAll('.main-image').forEach(img => {
                img.src = imageUrl;
            });
        } 
        else if (category === 'face') {
            const version = document.querySelector('.version-option.active')?.dataset.version || '1';
            const maxFaces = parseInt(version);
            
            if (optionItem.classList.contains('selected')) {
                optionItem.classList.remove('selected');
            } else {
                const selectedFaces = document.querySelectorAll('#face-grid .option-item.selected');
                if (selectedFaces.length < maxFaces) {
                    optionItem.classList.add('selected');
                } else {
                    alert(`Bạn chỉ được chọn tối đa ${maxFaces} khuôn mặt cho version này.`);
                    return;
                }
            }
        } 
        else if (category === 'hat' || category === 'accessory' || category === 'pet') {
            optionItem.classList.toggle('selected');
            
            const quantityContainer = optionItem.querySelector('.option-quantity');
            if (optionItem.classList.contains('selected')) {
                quantityContainer.style.display = 'flex';
                if (!optionItem.dataset.quantity) {
                    optionItem.dataset.quantity = '1';
                }
            } else {
                quantityContainer.style.display = 'none';
                delete optionItem.dataset.quantity;
            }
        }
        else {
            optionItem.classList.toggle('selected');
        }
        
        updateOrderSummary();
        saveSelections();
    });
    
    // Lưu lựa chọn
    function saveSelections() {
        const selections = {
            collection: window.selectedCollection || 'regular',
            version: document.querySelector('.version-option.active')?.dataset.version || '1',
            background: document.querySelector('#background-grid .option-item.selected')?.dataset.id,
            faces: Array.from(document.querySelectorAll('#face-grid .option-item.selected')).map(item => item.dataset.id),
            hairs: Array.from(document.querySelectorAll('#hair-options-container .option-item.selected')).map(item => item.dataset.id),
            hats: Array.from(document.querySelectorAll('#hat-grid .option-item.selected')).map(item => ({
                id: item.dataset.id,
                label: item.dataset.label,
                quantity: item.dataset.quantity || '1'
            })),
            accessories: Array.from(document.querySelectorAll('#accessory-grid .option-item.selected')).map(item => ({
                id: item.dataset.id,
                label: item.dataset.label,
                quantity: item.dataset.quantity || '1'
            })),
            pets: Array.from(document.querySelectorAll('#pet-grid .option-item.selected')).map(item => ({
                id: item.dataset.id,
                label: item.dataset.label,
                quantity: item.dataset.quantity || '1'
            })),
            clothing: Array.from(document.querySelectorAll('.color-option.selected')).map(item => ({
                code: item.dataset.code,
                type: item.dataset.type,
                color: item.dataset.color
            })),
            backgroundNote: document.getElementById('background-note').value
        };
        
        localStorage.setItem('customSelections', JSON.stringify(selections));
        
        const indicator = document.getElementById('save-indicator');
        indicator.style.display = 'block';
        setTimeout(() => {
            indicator.style.display = 'none';
        }, 2000);
    }
    
    // Tải lựa chọn đã lưu
    function loadSelections() {
        const saved = localStorage.getItem('customSelections');
        if (!saved) return;
        
        const selections = JSON.parse(saved);
        
        // Set selected collection
        if (selections.collection) {
            selectCollection(selections.collection);
        }
        
        // Set active version
        document.querySelectorAll('.version-option').forEach(opt => {
            opt.classList.remove('active');
            if (opt.dataset.version === selections.version) {
                opt.classList.add('active');
            }
        });
        updateCharacterDisplay(selections.version);
        
        if (selections.background) {
            const bgItem = document.querySelector(`#background-grid .option-item[data-id="${selections.background}"]`);
            if (bgItem) {
                bgItem.classList.add('selected');
                const imageUrl = bgItem.dataset.image;
                document.querySelectorAll('.main-image').forEach(img => {
                    img.src = imageUrl;
                });
            }
        }
        
        if (selections.backgroundNote) {
            document.getElementById('background-note').value = selections.backgroundNote;
        }
        
        selections.faces.forEach(faceId => {
            const faceItem = document.querySelector(`#face-grid .option-item[data-id="${faceId}"]`);
            if (faceItem) faceItem.classList.add('selected');
        });
        
        selections.hairs.forEach(hairId => {
            const hairItem = document.querySelector(`#hair-options-container .option-item[data-id="${hairId}"]`);
            if (hairItem) hairItem.classList.add('selected');
        });
        
        selections.hats.forEach(hat => {
            const hatItem = document.querySelector(`#hat-grid .option-item[data-id="${hat.id}"]`);
            if (hatItem) {
                hatItem.classList.add('selected');
                hatItem.dataset.quantity = hat.quantity;
                const quantityInput = hatItem.querySelector('.quantity-input');
                if (quantityInput) {
                    quantityInput.value = hat.quantity;
                    const quantityContainer = hatItem.querySelector('.option-quantity');
                    quantityContainer.style.display = 'flex';
                }
            }
        });
        
        selections.accessories.forEach(acc => {
            const accItem = document.querySelector(`#accessory-grid .option-item[data-id="${acc.id}"]`);
            if (accItem) {
                accItem.classList.add('selected');
                accItem.dataset.quantity = acc.quantity;
                const quantityInput = accItem.querySelector('.quantity-input');
                if (quantityInput) {
                    quantityInput.value = acc.quantity;
                    const quantityContainer = accItem.querySelector('.option-quantity');
                    quantityContainer.style.display = 'flex';
                }
            }
        });
        
        selections.pets.forEach(pet => {
            const petItem = document.querySelector(`#pet-grid .option-item[data-id="${pet.id}"]`);
            if (petItem) {
                petItem.classList.add('selected');
                petItem.dataset.quantity = pet.quantity;
                const quantityInput = petItem.querySelector('.quantity-input');
                if (quantityInput) {
                    quantityInput.value = pet.quantity;
                    const quantityContainer = petItem.querySelector('.option-quantity');
                    quantityContainer.style.display = 'flex';
                }
            }
        });
        
        selections.clothing.forEach(cloth => {
            const clothItem = document.querySelector(`.color-option[data-code="${cloth.code}"]`);
            if (clothItem) {
                const siblings = clothItem.parentElement.querySelectorAll(`.color-option[data-type="${cloth.type}"]`);
                siblings.forEach(sib => sib.classList.remove('selected'));
                clothItem.classList.add('selected');
            }
        });
        
        updateOrderSummary();
    }
    
    // Cập nhật tổng đơn hàng
    function updateOrderSummary() {
        const summaryContainer = document.getElementById('order-summary');
        let html = '';
        
        const activeVersion = document.querySelector('.version-option.active');
        const version = activeVersion?.dataset.version || '1';
        const versionName = `Version ${version}`;
        const versionPrice = parseInt(activeVersion?.dataset.price || '189000');
        
        html += `<div class="summary-item">
            <span>${versionName}</span>
            <span>${versionPrice.toLocaleString()}₫</span>
        </div>`;
        
        // Sửa lỗi: Sử dụng đúng selector cho background
        const selectedBackground = document.querySelector('#background-grid .option-item.selected');
        if (selectedBackground) {
            const backgroundName = selectedBackground.querySelector('.option-name').textContent;
            html += `<div class="summary-item">
                <span>Nền: ${backgroundName}</span>
                <span>0₫</span>
            </div>`;
        }
        
        const selectedFaces = document.querySelectorAll('#face-grid .option-item.selected');
        if (selectedFaces.length > 0) {
            const faceNames = Array.from(selectedFaces).map(face => 
                face.querySelector('.option-name').textContent
            ).join(', ');
            
            html += `<div class="summary-item">
                <span>Khuôn mặt: ${faceNames}</span>
                <span>0₫</span>
            </div>`;
        }
        
        const selectedHairs = document.querySelectorAll('#hair-options-container .option-item.selected');
        const hairCount = selectedHairs.length;
        const hairTotal = hairCount * 25000;
        if (hairCount > 0) {
            const hairNames = Array.from(selectedHairs).map(hair => 
                hair.querySelector('.option-name').textContent
            ).join(', ');
            
            html += `<div class="summary-item">
                <span>Tóc: ${hairNames}</span>
                <span>+${hairTotal.toLocaleString()}₫</span>
            </div>`;
        }
        
        const selectedShirts = Array.from(
            document.querySelectorAll('.color-option.selected[data-type^="shirt"]')
        ).map(opt => opt.dataset.color);
        const selectedPants  = Array.from(
            document.querySelectorAll('.color-option.selected[data-type^="pants"]')
        ).map(opt => opt.dataset.color);

        if (selectedShirts.length > 0) {
            html += `<div class="summary-item">
                <span>Áo: ${selectedShirts.join(', ')}</span>
                <span>0₫</span>
            </div>`;
        }
        if (selectedPants.length > 0) {
            html += `<div class="summary-item">
                <span>Quần: ${selectedPants.join(', ')}</span>
                <span>0₫</span>
            </div>`;
        }
        
        const selectedHats = document.querySelectorAll('#hat-grid .option-item.selected');
        let hatTotal = 0;
        if (selectedHats.length > 0) {
            const hatNames = [];
            selectedHats.forEach(hat => {
                const name = hat.querySelector('.option-name').textContent;
                const quantity = hat.dataset.quantity ? parseInt(hat.dataset.quantity) : 1;
                const price = parseInt(hat.dataset.price);
                hatTotal += price * quantity;
                hatNames.push(`${name} (x${quantity})`);
            });
            
            html += `<div class="summary-item">
                <span>Mũ: ${hatNames.join(', ')}</span>
                <span>+${hatTotal.toLocaleString()}₫</span>
            </div>`;
        }
        
        const selectedAccessories = document.querySelectorAll('#accessory-grid .option-item.selected');
        let accessoryTotal = 0;
        if (selectedAccessories.length > 0) {
            const accessoryNames = [];
            selectedAccessories.forEach(accessory => {
                const name = accessory.querySelector('.option-name').textContent;
                const quantity = accessory.dataset.quantity ? parseInt(accessory.dataset.quantity) : 1;
                const price = parseInt(accessory.dataset.price);
                accessoryTotal += price * quantity;
                accessoryNames.push(`${name} (x${quantity})`);
            });
            
            html += `<div class="summary-item">
                <span>Phụ kiện: ${accessoryNames.join(', ')}</span>
                <span>+${accessoryTotal.toLocaleString()}₫</span>
            </div>`;
        }
        const selectedPets = document.querySelectorAll('#pet-grid .option-item.selected');
        let petTotal = 0;
        if (selectedPets.length > 0) {
            const petNames = [];
            selectedPets.forEach(pet => {
                const name = pet.querySelector('.option-name').textContent;
                const quantity = pet.dataset.quantity ? parseInt(pet.dataset.quantity) : 1;
                const price = parseInt(pet.dataset.price);
                petTotal += price * quantity;
                petNames.push(`${name} (x${quantity})`);
            });
            
            html += `<div class="summary-item">
                <span>Thú cưng: ${petNames.join(', ')}</span>
                <span>+${petTotal.toLocaleString()}₫</span>
            </div>`;
        }
        
        let subtotal = versionPrice + hairTotal + hatTotal + accessoryTotal + petTotal;
        
        html += `<div class="summary-item subtotal">
            <span>Tạm tính</span>
            <span>${subtotal.toLocaleString()}₫</span>
        </div>`;
        
        const shippingFee = 0; // Shipping removed
        // Shipping row hidden
        const totalBeforeDiscount = subtotal + shippingFee;
        
        let discount = 0;
        const discountCode = document.getElementById('discount-code').value;
        const discountInfo = validDiscountCodes[discountCode.toUpperCase()];
        
        if (discountInfo) {
            if (discountInfo.type === 'freeship') {
                // No shipping fee; freeship has no effect now
                discount = 0;
            } else if (discountInfo.type === 'percent') {
                discount = Math.round(totalBeforeDiscount * discountInfo.value / 100);
                html += `<div class="summary-item discount">
                    <span>Giảm giá (${discountCode.toUpperCase()}): ${discountInfo.value}%</span>
                    <span>-${discount.toLocaleString()}₫</span>
                </div>`;
            } else if (discountInfo.type === 'fixed') {
                discount = discountInfo.value;
                html += `<div class="summary-item discount">
                    <span>Giảm giá (${discountCode.toUpperCase()})</span>
                    <span>-${discount.toLocaleString()}₫</span>
                </div>`;
            }
        }
        
        const total = Math.max(0, totalBeforeDiscount - discount);
        html += `<div class="summary-item total">
            <span>Tổng cộng</span>
            <span>${total.toLocaleString()}₫</span>
        </div>`;
        
        html += `<div class="summary-item" style="color: var(--light-pastel-pink); font-style: italic; margin-top: 10px;">
            <span>Nền của bạn có thể tự do custom, hãy <b>liên hệ shop</b> để designer thiết kế theo yêu cầu.</span>
        </div>`;
        
        summaryContainer.innerHTML = html;
        
        const resultDiv = document.getElementById('discount-result');
        if (discount > 0) {
            resultDiv.textContent = `Bạn tiết kiệm: ${discount.toLocaleString()}₫ - Thanh toán: ${total.toLocaleString()}₫`;
            resultDiv.className = 'discount-result valid';
            resultDiv.style.display = 'block';
        } else {
            resultDiv.style.display = 'none';
        }
        
        // Hide free-ship progress UI when shipping is removed
        const freeShipEl = document.getElementById('free-ship-progress');
        if (freeShipEl) freeShipEl.style.display = 'none';
        
        return {
            subtotal,
            shippingFee,
            discount,
            total,
            discountCode: discountInfo ? discountCode.toUpperCase() : null
        };
    }
    
    // Áp dụng mã giảm giá
    document.getElementById('apply-discount').addEventListener('click', function() {
        const discountCode = document.getElementById('discount-code').value;
        const resultDiv = document.getElementById('discount-result');
        
        if (!discountCode) {
            resultDiv.textContent = "Vui lòng nhập mã giảm giá";
            resultDiv.className = 'discount-result invalid';
            resultDiv.style.display = 'block';
            return;
        }
        
        if (validDiscountCodes[discountCode.toUpperCase()]) {
            updateOrderSummary();
            saveSelections();
        } else {
            resultDiv.textContent = "Mã giảm giá không hợp lệ";
            resultDiv.className = 'discount-result invalid';
            resultDiv.style.display = 'block';
        }
    });
    
    // Mở/đóng phần mã giảm giá
    document.getElementById('discount-toggle').addEventListener('click', function() {
        const form = document.getElementById('discount-form');
        this.classList.toggle('active');
        form.classList.toggle('active');
    });
    
    // ===== QUẢN LÝ ĐẶT HÀNG =====
    // Xác thực form
    function validateForm() {
        let isValid = true;
        const name = document.getElementById('customer-name').value.trim();
        const phone = document.getElementById('customer-phone').value.trim();
        const address = document.getElementById('customer-address').value.trim();
        const deliveryDate = document.getElementById('delivery-date').value.trim();
        const email = document.getElementById('customer-email').value.trim();
        const instagram = (document.getElementById('customer-instagram')?.value || '').trim();

        // Reset errors
        document.querySelectorAll('.form-error').forEach(el => el.style.display = 'none');

        // Validate name
        if (!name) {
            document.getElementById('name-error').style.display = 'block';
            isValid = false;
        }

        // Validate phone
        if (!phone) {
            document.getElementById('phone-error').textContent = 'Vui lòng nhập số điện thoại';
            document.getElementById('phone-error').style.display = 'block';
            isValid = false;
        } else if (!/^(0[0-9]{9,10})$/.test(phone)) {
            document.getElementById('phone-error').textContent = 'Số điện thoại không hợp lệ';
            document.getElementById('phone-error').style.display = 'block';
            isValid = false;
        }

        // Validate address
        if (!address) {
            document.getElementById('address-error').style.display = 'block';
            isValid = false;
        }

        // Validate delivery date
        if (!deliveryDate) {
            document.getElementById('delivery-date-error').textContent = 'Vui lòng chọn ngày nhận hàng';
            document.getElementById('delivery-date-error').style.display = 'block';
            isValid = false;
        } else {
            // Check if selected date is at least 3 days from today
            const today = new Date();
            const minDate = new Date();
            minDate.setDate(today.getDate() + 3);
            
            // Parse the selected date (format: dd/mm)
            const [day, month] = deliveryDate.split('/');
            const selectedDate = new Date(today.getFullYear(), parseInt(month) - 1, parseInt(day));
            
            if (selectedDate < minDate) {
                document.getElementById('delivery-date-error').textContent = 'Ngày nhận hàng phải ít nhất 3 ngày kể từ hôm nay';
            document.getElementById('delivery-date-error').style.display = 'block';
            isValid = false;
            }
        }

        // Validate email (required)
        if (!email) {
            document.getElementById('email-error').textContent = 'Vui lòng nhập email';
            document.getElementById('email-error').style.display = 'block';
            isValid = false;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            document.getElementById('email-error').textContent = 'Email không hợp lệ';
            document.getElementById('email-error').style.display = 'block';
            isValid = false;
        }

        // Validate instagram (required)
        if (!instagram) {
            document.getElementById('instagram-error').textContent = 'Vui lòng nhập tên Instagram';
            document.getElementById('instagram-error').style.display = 'block';
            isValid = false;
        }

        return isValid;
    }

    // Save order to Supabase database
    async function saveToSupabase(customerInfo, orderSummary) {
        console.log('🚀 [DEBUG] Starting saveToSupabase...');
        console.log('📋 [DEBUG] Customer Info:', customerInfo);
        console.log('💰 [DEBUG] Order Summary:', orderSummary);
        
        try {
            const items = prepareOrderItems();
            console.log('📦 [DEBUG] Prepared items:', items);
            
            const orderData = {
                customerInfo: {
                    name: customerInfo.name,
                    phone: customerInfo.phone,
                    email: customerInfo.email || '',
                    address: customerInfo.address,
                    instagram: customerInfo.instagram || ''
                },
                items: items,
                total: orderSummary.total || 0,
                notes: customerInfo.note + ' | Ngày nhận: ' + customerInfo.deliveryDate
            };
            
            console.log('📤 [DEBUG] Sending order data to API:', orderData);
            console.log('🔗 [DEBUG] API Endpoint: /api/orders');
            console.log('💰 [DEBUG] Total value:', orderSummary.total, 'Type:', typeof orderSummary.total);

            const response = await fetch('/api/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            });

            console.log('📡 [DEBUG] Response status:', response.status, response.statusText);
            console.log('📡 [DEBUG] Response headers:', Object.fromEntries(response.headers.entries()));

            if (!response.ok) {
                const errorText = await response.text();
                console.error('❌ [DEBUG] Response not OK:', errorText);
                throw new Error(`Failed to save to database: ${response.status} - ${errorText}`);
            }

            const result = await response.json();
            console.log('✅ [DEBUG] API Response:', result);
            console.log('✅ Order saved to Supabase:', result.order?.id || 'ID not found');
            return result;
        } catch (error) {
            console.error('❌ [DEBUG] Error in saveToSupabase:', error);
            console.error('❌ [DEBUG] Error stack:', error.stack);
            console.error('❌ [DEBUG] Error message:', error.message);
            throw error;
        }
    }

    // Prepare order items for database
    function prepareOrderItems() {
        console.log('📦 [DEBUG] prepareOrderItems called');
        const items = [];
        
        // Add background
        const selectedBg = document.querySelector('#background-grid .option-item.selected');
        if (selectedBg) {
            items.push({
                id: selectedBg.dataset.id || 'custom',
                name: selectedBg.querySelector('.option-name').textContent,
                type: 'background',
                price: 0
            });
        }
        
        // Add hairs
        document.querySelectorAll('#hair-options-container .option-item.selected').forEach(item => {
            items.push({
                id: item.dataset.id || 'hair',
                name: item.querySelector('.option-name').textContent,
                type: 'hair',
                price: parseInt(item.dataset.price || 25000)
            });
        });
        
        // Add hats
        document.querySelectorAll('#hat-grid .option-item.selected').forEach(item => {
            const quantity = parseInt(item.dataset.quantity || 1);
            items.push({
                id: item.dataset.id || 'hat',
                name: item.querySelector('.option-name').textContent,
                type: 'hat',
                price: parseInt(item.dataset.price || 10000),
                quantity
            });
        });
        
        // Add accessories
        document.querySelectorAll('#accessory-grid .option-item.selected').forEach(item => {
            const quantity = parseInt(item.dataset.quantity || 1);
            items.push({
                id: item.dataset.id || 'accessory',
                name: item.querySelector('.option-name').textContent,
                type: 'accessory',
                price: parseInt(item.dataset.price || 10000),
                quantity
            });
        });
        
        // Add pets
        document.querySelectorAll('#pet-grid .option-item.selected').forEach(item => {
            const quantity = parseInt(item.dataset.quantity || 1);
            items.push({
                id: item.dataset.id || 'pet',
                name: item.querySelector('.option-name').textContent,
                type: 'pet',
                price: parseInt(item.dataset.price || 15000),
                quantity
            });
        });
        
        // Add clothing colors
        document.querySelectorAll('.color-option.selected').forEach(item => {
            items.push({
                id: item.dataset.code || 'color',
                name: `${item.dataset.color} (${item.dataset.type})`,
                type: 'clothing',
                price: 0,
                color: item.dataset.color,
                clothing_type: item.dataset.type
            });
        });
        
        console.log('📦 [DEBUG] Total items prepared:', items.length);
        console.log('📦 [DEBUG] Items:', items);
        return items;
    }

    // Gửi đơn hàng
    function sendOrder(customerInfo, orderSummary) {
        console.log('🎯 [DEBUG] sendOrder called');
        console.log('👤 [DEBUG] Customer Info:', customerInfo);
        console.log('📊 [DEBUG] Order Summary:', orderSummary);
        
        // Save to Supabase database
        saveToSupabase(customerInfo, orderSummary)
        .then((result) => {
            console.log('✅ [DEBUG] Order saved successfully!', result);
            
            // Redirect to success page with order data
            const orderData = {
                name: customerInfo.name,
                phone: customerInfo.phone,
                email: customerInfo.email,
                instagram: customerInfo.instagram,
                address: customerInfo.address,
                deliveryDate: customerInfo.deliveryDate,
                total: orderSummary.total.toLocaleString() + '₫'
            };
            
            const params = new URLSearchParams(orderData);
            window.location.href = `success.html?${params.toString()}`;
            
            console.log('✅ [DEBUG] Redirecting to success page');
        })
        .catch(error => {
            console.error('❌ [DEBUG] Order submission error:', error);
            console.error('❌ [DEBUG] Error type:', error.constructor.name);
            console.error('❌ [DEBUG] Error message:', error.message);
            console.error('❌ [DEBUG] Full error:', error);
            
            // Show detailed error message to user
            const errorMsg = error.message || 'Unknown error';
            alert(`Có lỗi xảy ra khi gửi đơn hàng:\n\n${errorMsg}\n\nVui lòng kiểm tra console (F12) và liên hệ hỗ trợ.`);
        })
        .finally(() => {
            console.log('🏁 [DEBUG] sendOrder finally block - cleaning up');
            
            // Ẩn spinner và kích hoạt lại nút
            document.getElementById('order-spinner').style.display = 'none';
            document.getElementById('order-text').style.display = 'inline';
            document.getElementById('confirm-button').disabled = false;
            
            console.log('🏁 [DEBUG] UI cleanup complete');
        });
    }

    // Xử lý khi bấm nút "Đặt hàng"
    document.getElementById('confirm-button').addEventListener('click', function() {
        if (!validateForm()) return;
        
        const name = document.getElementById('customer-name').value.trim();
        const phone = document.getElementById('customer-phone').value.trim();
        const address = document.getElementById('customer-address').value.trim();
        const email = document.getElementById('customer-email').value.trim();
        const note = document.getElementById('customer-note').value.trim();
        const instagram = (document.getElementById('customer-instagram')?.value || '').trim();
        const deliveryDate = document.getElementById('delivery-date').value.trim();
        
        if (!document.getElementById('policy-agreement').checked) {
            alert('Vui lòng đồng ý với chính sách bảo hành & điều khoản của The Luvin.');
            return;
        }
        
        // Hiển thị spinner và vô hiệu hóa nút
        document.getElementById('order-spinner').style.display = 'block';
        document.getElementById('order-text').style.display = 'none';
        this.disabled = true;
        
        // Tạo đối tượng thông tin khách hàng
        const customerInfo = {
            name: name,
            phone: phone,
            address: address,
            email: email,
            note: note || 'Không có ghi chú',
            instagram: instagram,
            deliveryDate: deliveryDate
        };
        
        // Lấy thông tin tóm tắt đơn hàng
        const orderSummary = updateOrderSummary();
        console.log('📊 [DEBUG] Order Summary from updateOrderSummary():', orderSummary);
        console.log('📊 [DEBUG] Order Summary total value:', orderSummary.total, 'Type:', typeof orderSummary.total);
        
        // Gửi đơn hàng
        sendOrder(customerInfo, orderSummary);
    });

    // ===== QUẢN LÝ CÁC BƯỚC =====
    // Chuyển đến bước cụ thể
    function goToStep(stepNumber) {
        // Ẩn tất cả các bước
        document.querySelectorAll('.step-pane').forEach(pane => {
            pane.classList.remove('active');
        });
        
        // Hiển thị bước được chọn
        document.getElementById(`step-${stepNumber}`).classList.add('active');
        
        // Cập nhật trạng thái active của thanh điều hướng
        document.querySelectorAll('.step').forEach(step => {
            step.classList.remove('active');
        });
        document.querySelector(`.step[data-step="${stepNumber}"]`).classList.add('active');
        
        // Cập nhật trạng thái nút điều hướng
        updateNavigationButtons(stepNumber);
        
        // Lưu bước hiện tại
        localStorage.setItem('currentStep', stepNumber);
    }
    
    // Cập nhật trạng thái nút điều hướng
    function updateNavigationButtons(currentStep) {
        const currentPane = document.getElementById(`step-${currentStep}`);
        if (!currentPane) return;
        
        const prevBtn = currentPane.querySelector('.prev-btn');
        const nextBtn = currentPane.querySelector('.next-btn');
        
        if (prevBtn) {
            // Disable nút "Quay lại" ở step 1
            prevBtn.disabled = (currentStep === 1);
        }
        
        if (nextBtn) {
            // Ẩn nút "Tiếp theo" ở step cuối (step 6)
            if (currentStep === 6) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'inline-block';
                nextBtn.disabled = false;
            }
        }
    }
    
    // Xử lý nút "Tiếp theo"
    document.querySelectorAll('.next-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const currentPane = this.closest('.step-pane');
            const currentStep = parseInt(currentPane.id.split('-')[1]);
            
            // Kiểm tra bước 3: Chọn Background
            if (currentStep === 3) {
                const backgroundNote = document.getElementById('background-note').value.trim();
                if (!backgroundNote) {
                    alert('Vui lòng nhập ghi chú cho background.');
                    return; // Không chuyển bước nếu để trống
                }
            }
            
            goToStep(currentStep + 1);
        });
    });
    
    // Xử lý nút "Quay lại"
    document.querySelectorAll('.prev-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const currentPane = this.closest('.step-pane');
            const currentStep = parseInt(currentPane.id.split('-')[1]);
            goToStep(currentStep - 1);
        });
    });
    
    // Xử lý khi click vào bước điều hướng
    document.querySelectorAll('.step').forEach(step => {
        step.addEventListener('click', function() {
            const stepNumber = this.dataset.step;
            goToStep(parseInt(stepNumber));
        });
    });
    
    // Xử lý nút trong popup xác nhận

    document.getElementById('popup-facebook').addEventListener('click', function() {
        window.open('https://www.facebook.com/lgou.official', '_blank');
    });

    document.getElementById('popup-instagram').addEventListener('click', function() {
        window.open('https://www.instagram.com/lgou.official/', '_blank');
    });

    // Đóng popup khi bấm nút đóng
    document.querySelector('#confirmation-popup .popup-close').addEventListener('click', function() {
        document.getElementById('popup-overlay').style.display = 'none';
        document.getElementById('confirmation-popup').style.display = 'none';
    });

    // Đóng popup khi click overlay
    document.getElementById('popup-overlay').addEventListener('click', function() {
        this.style.display = 'none';
        document.getElementById('confirmation-popup').style.display = 'none';
    });
    
    // Fetch products from Supabase with caching and collection filtering
    async function fetchProductsFromSupabase(forceRefresh = false, collectionId = null) {
        try {
            // Use selected collection if not provided
            const targetCollection = collectionId || window.selectedCollection || 'regular';
            
            // Check cache first (unless force refresh)
            const cacheKey = `${CACHE_KEYS.PRODUCTS}_${targetCollection}`;
            if (!forceRefresh) {
                const cachedProducts = getCache(cacheKey);
                if (cachedProducts) {
                    console.log(`📦 Loading products from cache for collection: ${targetCollection}...`);
                    updateProductOptions(cachedProducts);
                    renderAllOptionGrids();
                    return;
                }
            }
            
            console.log(`🔄 Fetching products from Supabase for collection: ${targetCollection}...`);
            console.log(`🔄 Collection ID type: ${typeof targetCollection}, length: ${targetCollection ? targetCollection.length : 'undefined'}`);
            console.log(`🔄 Collection ID value: "${targetCollection}"`);
            
            // Fetch products filtered by collection
            const url = `/api/products${targetCollection && targetCollection !== 'all' ? `?collection_id=${encodeURIComponent(targetCollection)}` : ''}`;
            console.log(`🔄 Fetching from URL: ${url}`);
            
            const response = await fetch(url);
            const data = await response.json();
            
            console.log(`🔄 Response status: ${response.status}`);
            console.log(`🔄 Response data:`, data);
            
            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch products');
            }
            
            const products = data.products || [];
            console.log(`✅ Fetched ${products.length} products for collection: ${targetCollection}`);
            console.log(`📦 Products:`, products);
            
            // Cache the products by collection
            setCache(cacheKey, products);
            
            // Update product options
            updateProductOptions(products);
            
            // Re-render all option grids
            renderAllOptionGrids();
            
        } catch (error) {
            console.error('❌ Error fetching products from Supabase:', error);
            
            // Try to load from cache as fallback
            const targetCollection = collectionId || window.selectedCollection || 'regular';
            const cacheKey = `${CACHE_KEYS.PRODUCTS}_${targetCollection}`;
            const cachedProducts = getCache(cacheKey);
            if (cachedProducts) {
                console.log('🔄 Using cached products as fallback...');
                updateProductOptions(cachedProducts);
                renderAllOptionGrids();
            } else {
                console.log('🔄 No cache available, using empty arrays...');
                renderAllOptionGrids();
            }
        }
    }

    // Update product options from products data
    function updateProductOptions(products) {
        // Group products by category
        const productsByCategory = {
            face: [],
            hair: [],
            hat: [],
            accessories: [],
            pets: [],
            background: []
        };
        
        products.forEach(product => {
            console.log('🔄 Processing product:', product.name, 'category:', product.category);
            if (productsByCategory[product.category]) {
                productsByCategory[product.category].push({
                    id: product.id,
                    label: product.name,
                    image: product.image,
                    price: product.price || 0
                });
                console.log('✅ Added to category:', product.category);
            } else {
                console.log('❌ Unknown category:', product.category);
            }
        });
        
        console.log('📦 Products by category:', productsByCategory);
        
        // Update product options
        productOptions.faces = productsByCategory.face;
        
        // Filter hair by gender
        const allHairs = productsByCategory.hair;
        productOptions.maleHairs = allHairs.filter(p => p.label.toLowerCase().includes('nam') || p.label.toLowerCase().includes('male'));
        productOptions.femaleHairs = allHairs.filter(p => p.label.toLowerCase().includes('nữ') || p.label.toLowerCase().includes('female'));
        
        console.log('💇 Hair filtering - total:', allHairs.length, 'male:', productOptions.maleHairs.length, 'female:', productOptions.femaleHairs.length);
        
        productOptions.hats = productsByCategory.hat;
        productOptions.accessories = productsByCategory.accessories;
        productOptions.pets = productsByCategory.pets;
        productOptions.backgrounds = productsByCategory.background;
        
        console.log('✅ Updated product options:', productOptions);
    }

    // Re-render all option grids
    function renderAllOptionGrids() {
        console.log('🎨 Rendering all option grids...');
        console.log('📊 Product options:', productOptions);
        
        // Render face options
        console.log('👤 Rendering face options:', productOptions.faces.length);
        renderOptions(document.getElementById('face-grid'), productOptions.faces, 'face');
        
        // Render hair options - create the container first, then render
        console.log('💇 Rendering hair options - male:', productOptions.maleHairs.length, 'female:', productOptions.femaleHairs.length);
        createHairOptions();
        
        // Render hat options
        console.log('🎩 Rendering hat options:', productOptions.hats.length);
        renderOptions(document.getElementById('hat-grid'), productOptions.hats, 'hat');
        
        // Render accessory options
        console.log('📱 Rendering accessory options:', productOptions.accessories.length);
        renderOptions(document.getElementById('accessory-grid'), productOptions.accessories, 'accessory');
        
        // Render pet options
        console.log('🐾 Rendering pet options:', productOptions.pets.length);
        renderOptions(document.getElementById('pet-grid'), productOptions.pets, 'pet');
        
        // Render background options
        console.log('🖼️ Rendering background options:', productOptions.backgrounds.length);
        renderOptions(document.getElementById('background-grid'), productOptions.backgrounds, 'background');
        
        // Update default image with first background after rendering
        updateDefaultImageFromFirstBackground();
        
        console.log('✅ All option grids rendered');
    }
    
    // Cache invalidation - call this when data changes
    function invalidateCache() {
        console.log('🗑️ Invalidating cache...');
        clearCache();
    }

    // Force refresh products (for debugging)
    async function forceRefreshProducts() {
        console.log('🔄 Force refreshing products...');
        clearCache();
        await fetchProductsFromSupabase(true);
    }

    // Update default image with first background from Supabase
    function updateDefaultImageFromFirstBackground() {
        console.log('🖼️ Updating default image with first background...');
        
        // Wait a bit for DOM to be ready
        setTimeout(() => {
            const firstBackground = document.querySelector('#background-grid .option-item');
            if (firstBackground) {
                const imageUrl = firstBackground.dataset.image;
                if (imageUrl) {
                    console.log('✅ Setting default image to:', imageUrl);
                    document.querySelectorAll('.main-image').forEach(img => {
                        img.src = imageUrl;
                    });
                    // Also select the first background
                    firstBackground.classList.add('selected');
                }
            } else {
                console.log('⚠️ No background products found');
            }
        }, 100);
    }

    // Check for updates periodically (every 2 minutes)
    function startCacheUpdateCheck() {
        setInterval(async () => {
            try {
                // Check if we need to refresh cache
                const response = await fetch('/api/products?check_update=true');
                if (response.ok) {
                    const data = await response.json();
                    if (data.updated) {
                        console.log('🔄 Data updated, refreshing cache...');
                        await fetchProductsFromSupabase(true);
                    }
                }
            } catch (error) {
                console.warn('Cache update check failed:', error);
            }
        }, 2 * 60 * 1000); // Check every 2 minutes
    }
    
    // Khởi động trang
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Initializing website with caching...');
        
        // Load cached data first for instant display
        const cachedProducts = getCache(CACHE_KEYS.PRODUCTS);
        if (cachedProducts) {
            console.log('⚡ Loading from cache for instant display...');
            updateProductOptions(cachedProducts);
            renderAllOptionGrids();
        }
        
        // Initialize other components
        loadInventoryFromCMS(); // Load inventory from CMS first
        loadCollectionsFromCMS(); // Load collections from CMS first
        setupCollectionSync(); // Setup sync with CMS
        renderCollections();
        startCollectionTimers();
        initOptions();
        updateCharacterDisplay('1');
        loadSelections();
        
        // Fetch fresh data from Supabase (will update cache)
        fetchProductsFromSupabase().then(() => {
            // Set first background as default image after products are loaded
            updateDefaultImageFromFirstBackground();
        });
        
        // Start periodic cache updates
        startCacheUpdateCheck();
        
        document.getElementById('discount-code').value = '';
        updateOrderSummary();
        
        // Khôi phục bước đã lưu hoặc bắt đầu từ bước 1
        const savedStep = localStorage.getItem('currentStep') || 1;
        goToStep(parseInt(savedStep));
        
        // Date Picker Implementation
        class DatePicker {
            constructor(inputId, calendarId) {
                this.input = document.getElementById(inputId);
                this.calendar = document.getElementById(calendarId);
                this.currentDate = new Date();
                this.selectedDate = null;
                this.minDate = new Date();
                this.minDate.setDate(this.minDate.getDate() + 3); // Minimum 3 days from today
                
                this.init();
            }

            init() {
                this.renderCalendar();
                this.bindEvents();
            }

            bindEvents() {
                console.log('🔧 Binding date picker events...');
                
                // Toggle calendar on input click
                this.input.addEventListener('click', (e) => {
                    console.log('📅 Date input clicked');
                    e.preventDefault();
                    this.toggleCalendar();
                });

                // Close calendar when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.calendar.contains(e.target) && !this.input.contains(e.target)) {
                        this.hideCalendar();
                    }
                });

                // Handle calendar day clicks using event delegation
                this.calendar.addEventListener('click', (e) => {
                    console.log('🔍 Calendar click detected:', e.target);
                    console.log('🔍 Target classes:', e.target.classList);
                    console.log('🔍 Is calendar-day:', e.target.classList.contains('calendar-day'));
                    console.log('🔍 Is disabled:', e.target.classList.contains('disabled'));
                    
                    if (e.target.classList.contains('calendar-day') && !e.target.classList.contains('disabled')) {
                        console.log('✅ Valid date click, selecting date:', e.target.dataset.date);
                        this.selectDate(e.target);
                    } else {
                        console.log('❌ Invalid date click - not selectable');
                    }
                });

                // Navigation buttons
                document.getElementById('prev-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('next-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });
            }

            toggleCalendar() {
                console.log('🔄 Toggling calendar...');
                if (this.calendar.classList.contains('show')) {
                    this.hideCalendar();
                } else {
                    this.showCalendar();
                }
            }

            showCalendar() {
                console.log('📅 Showing calendar');
                this.renderCalendar();
                this.calendar.classList.add('show');
                console.log('📅 Calendar classes after show:', this.calendar.className);
            }

            hideCalendar() {
                this.calendar.classList.remove('show');
            }

            renderCalendar() {
                console.log('🎨 Rendering calendar...');
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                console.log('📅 Rendering for:', year, month);
                
                // Update month/year display
                const monthNames = [
                    'Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                    'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'
                ];
                document.getElementById('calendar-month-year').textContent = `${monthNames[month]} ${year}`;
                console.log('📅 Month/year updated:', document.getElementById('calendar-month-year').textContent);

                // Get first day of month and number of days
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                // Day headers
                const dayHeaders = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
                
                let calendarHTML = '';
                
                // Add day headers
                dayHeaders.forEach(day => {
                    calendarHTML += `<div class="calendar-day-header">${day}</div>`;
                });

                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDayOfWeek; i++) {
                    calendarHTML += '<div class="calendar-day"></div>';
                }

                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const isDisabled = date < this.minDate;
                    const isToday = this.isToday(date);
                    const isSelected = this.selectedDate && this.isSameDate(date, this.selectedDate);
                    
                    let classes = 'calendar-day';
                    if (isDisabled) classes += ' disabled';
                    if (isToday) classes += ' today';
                    if (isSelected) classes += ' selected';

                    calendarHTML += `
                        <div class="${classes}" data-date="${this.formatDate(date)}">
                            ${day}
                        </div>
                    `;
                }

                document.getElementById('calendar-grid').innerHTML = calendarHTML;
            }

            selectDate(element) {
                console.log('🎯 selectDate called with element:', element);
                const dateStr = element.dataset.date;
                console.log('📅 Date string from dataset:', dateStr);
                
                const date = new Date(dateStr);
                console.log('📅 Parsed date:', date);
                console.log('📅 Parsed date local components:', {
                    year: date.getFullYear(),
                    month: date.getMonth(),
                    day: date.getDate()
                });
                console.log('📅 Min date:', this.minDate);
                console.log('📅 Date < minDate:', date < this.minDate);
                
                if (date < this.minDate) {
                    console.log('❌ Date is before minimum date, ignoring');
                    return;
                }
                
                this.selectedDate = date;
                this.input.value = this.formatDateForDisplay(date);
                console.log('✅ Date selected and input updated:', this.input.value);
                
                this.hideCalendar();
                
                // Trigger validation
                console.log('🔍 Triggering form validation');
                validateForm();
            }

            formatDate(date) {
                // Use local date formatting to avoid timezone issues
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            formatDateForDisplay(date) {
                // Use local date formatting to avoid timezone issues
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }

            isToday(date) {
                const today = new Date();
                return this.isSameDate(date, today);
            }

            isSameDate(date1, date2) {
                return date1.getDate() === date2.getDate() &&
                       date1.getMonth() === date2.getMonth() &&
                       date1.getFullYear() === date2.getFullYear();
            }
        }

        // Initialize date picker
        let datePicker;
        
        // Initialize date picker when DOM is ready
        function initDatePicker() {
            if (document.getElementById('delivery-date') && document.getElementById('date-picker-calendar')) {
                datePicker = new DatePicker('delivery-date', 'date-picker-calendar');
                window.datePicker = datePicker; // Make it globally accessible
                console.log('✅ Date picker initialized');
            } else {
                console.log('❌ Date picker elements not found, retrying...');
                setTimeout(initDatePicker, 100);
            }
        }
        
        // Try to initialize immediately
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDatePicker);
        } else {
            initDatePicker();
        }
        
        // Thêm sự kiện validate real-time
        document.getElementById('customer-name').addEventListener('input', validateForm);
        document.getElementById('customer-phone').addEventListener('input', validateForm);
        document.getElementById('customer-address').addEventListener('input', validateForm);
        document.getElementById('delivery-date').addEventListener('input', validateForm);
        document.getElementById('customer-email').addEventListener('input', validateForm);
        document.getElementById('customer-instagram').addEventListener('input', validateForm);
    });
</script>
</body>
</html>
